<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Analytics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* CSS Unifi√© pour Dashboard PMMS avec Design IMAS */

   * {
       margin: 0;
       padding: 0;
       box-sizing: border-box;
   }

   body {
       font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
       background-color: var(--bg-color);
       color: var(--text-color);
       transition: all 0.3s ease;
   }

   /* Variables CSS */
   :root {
       --bg-color: #f5f5f5;
       --sidebar-bg: #ffffff;
       --header-bg: #ffffff;
       --text-color: #333333;
       --text-secondary: #666666;
       --border-color: #e0e0e0;
       --hover-bg: #f0f0f0;
       --red-color: #0bdef9;
       --blue-color: #1976d2;
       --green-color: #388e3c;
       --shadow: 0 2px 10px rgba(0,0,0,0.1);
       --chart-bg: #ffffff;
       --sidebar-width: 280px;
       --header-height: 70px;
   }

   body.dark-mode {
       --bg-color: #121212;
       --sidebar-bg: #1e1e1e;
       --header-bg: #1e1e1e;
       --text-color: #ffffff;
       --text-secondary: #b3b3b3;
       --border-color: #333333;
       --hover-bg: #2a2a2a;
       --shadow: 0 2px 10px rgba(0,0,0,0.3);
       --chart-bg: #1e1e1e;
   }

   /* Container Principal */
   .container {
       display: flex;
       min-height: 100vh;
   }

   /* Sidebar Styles */
   .sidebar {
       width: var(--sidebar-width);
       background-color: var(--sidebar-bg);
       border-right: 1px solid var(--border-color);
       transition: all 0.3s ease;
       box-shadow: var(--shadow);
       position: fixed;
       top: 0;
       left: 0;
       height: 100vh;
       z-index: 1000;
       display: flex;
       flex-direction: column;
       overflow-y: auto;
   }

   .sidebar.collapsed {
       width: 80px;
       overflow: hidden;
   }

   .sidebar.collapsed .nav-item span,
   .sidebar.collapsed .company-name,
   .sidebar.collapsed .logo-section img,
   .sidebar.collapsed .logout-btn span,
   .sidebar.collapsed .menu-text {
       display: none;
   }

   .sidebar.collapsed .nav-item,
   .sidebar.collapsed .sidebar-menu a {
       justify-content: center;
       padding: 12px 0;
   }

   .sidebar.collapsed .nav-item i,
   .sidebar.collapsed .sidebar-menu i {
       margin-right: 0;
       font-size: 20px;
   }

   .sidebar.hidden {
       transform: translateX(-100%);
   }

   /* Logo Section */
   .logo-section {
       padding: 20px;
       border-bottom: 1px solid var(--border-color);
       text-align: center;
       display: flex;
       flex-direction: column;
       align-items: center;
       gap: 10px;
   }

   .logo {
       display: flex;
       align-items: center;
       gap: 12px;
       transition: transform 0.3s ease;
       justify-content: center;
   }

   .logo:hover {
       transform: scale(1.05);
   }

   .logo-section img,
   .logo-image {
       width: 120px;
       height: auto;
       transition: all 0.3s ease;
       border-radius: 8px;
       object-fit: contain;
   }

   .company-name,
   .logo-text {
       font-size: 16px;
       font-weight: bold;
       color: var(--red-color);
       text-transform: uppercase;
       letter-spacing: 1px;
       transition: all 0.3s ease;
   }

   .logo-text span {
       color: #ff6b6b;
   }

   /* Navigation Menu */
   .nav-menu,
   .sidebar-menu {
       padding: 20px 0;
       flex: 1;
       display: flex;
       flex-direction: column;
       gap: 8px;
       overflow-y: auto;
       list-style: none;
       margin: 0;
   }

   .sidebar-menu li {
       border-bottom: 1px solid transparent;
   }

   .nav-item,
   .sidebar-menu a {
       display: flex;
       align-items: center;
       padding: 12px 20px;
       color: var(--text-secondary);
       text-decoration: none;
       transition: all 0.3s ease;
       border-left: 3px solid transparent;
       font-size: 14px;
       margin: 0 10px;
       border-radius: 6px;
       cursor: pointer;
   }

   .nav-item:hover,
   .sidebar-menu a:hover {
       background-color: var(--hover-bg);
       color: var(--text-color);
   }

   .nav-item.active,
   .sidebar-menu a.active {
       background-color: var(--hover-bg);
       color: var(--red-color);
       border-left-color: var(--red-color);
       font-weight: 500;
   }

   .nav-item i,
   .sidebar-menu i {
       margin-right: 12px;
       width: 20px;
       text-align: center;
       font-size: 16px;
   }

   /* Logout Section */
   .logout-section {
       padding: 20px;
       border-top: 1px solid var(--border-color);
   }

   .logout-btn {
       display: flex;
       align-items: center;
       padding: 12px 20px;
       color: var(--red-color);
       text-decoration: none;
       font-weight: 500;
       font-size: 16px;
       transition: all 0.3s ease;
       border-radius: 6px;
       cursor: pointer;
   }

   .logout-btn:hover {
       background-color: var(--hover-bg);
   }

   /* Header Styles */
   .header {
       background-color: var(--header-bg);
       border-bottom: 1px solid var(--border-color);
       padding: 15px 30px;
       display: flex;
       align-items: center;
       justify-content: space-between;
       box-shadow: var(--shadow);
       position: fixed;
       top: 0;
       right: 0;
       left: var(--sidebar-width);
       z-index: 999;
       transition: left 0.3s ease;
       height: var(--header-height);
   }

   .sidebar.collapsed ~ .main-content .header,
   .sidebar.collapsed + .header {
       left: 80px;
   }

   .header-left {
       display: flex;
       align-items: center;
   }

   .header-center {
       flex-grow: 1;
       display: flex;
       justify-content: center;
       align-items: center;
   }

   .header-right {
       display: flex;
       align-items: center;
       gap: 15px;
   }

   .sidebar-toggle,
   .header-btn {
       background: var(--red-color);
       color: white;
       border: none;
       width: 35px;
       height: 35px;
       border-radius: 8px;
       cursor: pointer;
       display: flex;
       align-items: center;
       justify-content: center;
       margin-right: 20px;
       transition: all 0.3s ease;
       font-size: 14px;
       font-weight: 500;
       padding: 0 12px;
       gap: 6px;
       min-width: 80px;
   }

   .sidebar-toggle:hover,
   .header-btn:hover {
       transform: scale(1.05);
       background: rgba(11, 222, 249, 0.8);
   }

   .header-title {
       font-size: 18px;
       font-weight: 600;
       color: var(--text-color);
       margin: 0;
   }

   .search-container {
       position: relative;
       width: 400px;
   }

   .search-bar {
       width: 100%;
       padding: 10px 15px;
       border: 1px solid var(--border-color);
       border-radius: 25px;
       background-color: var(--bg-color);
       color: var(--text-color);
       font-size: 14px;
       outline: none;
       transition: all 0.3s ease;
   }

   .search-bar:focus {
       border-color: var(--blue-color);
       box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
   }

   .theme-toggle {
       background: none;
       border: 1px solid var(--border-color);
       color: var(--text-color);
       width: 35px;
       height: 35px;
       border-radius: 8px;
       cursor: pointer;
       display: flex;
       align-items: center;
       justify-content: center;
       transition: all 0.3s ease;
   }

   .theme-toggle:hover {
       background-color: var(--hover-bg);
       transform: scale(1.05);
   }

   .notification-bell {
       position: relative;
       cursor: pointer;
   }

   .notification-badge {
       position: absolute;
       top: -5px;
       right: -5px;
       background-color: var(--red-color);
       color: white;
       border-radius: 50%;
       width: 18px;
       height: 18px;
       display: flex;
       align-items: center;
       justify-content: center;
       font-size: 10px;
       font-weight: bold;
   }

   /* Profile Styles */
   .profile-container,
   .user-profile {
       display: flex;
       align-items: center;
       gap: 10px;
       cursor: pointer;
       padding: 8px 12px;
       border-radius: 25px;
       background-color: rgba(11, 222, 249, 0.1);
       transition: all 0.3s ease;
   }

   .profile-container:hover,
   .user-profile:hover {
       background-color: rgba(11, 222, 249, 0.2);
   }

   .user-avatar,
   .avatar {
       width: 35px;
       height: 35px;
       border-radius: 50%;
       background-color: var(--blue-color);
       color: white;
       display: flex;
       align-items: center;
       justify-content: center;
       font-weight: bold;
       object-fit: cover;
       border: 2px solid rgba(11, 222, 249, 0.3);
       transition: all 0.3s ease;
   }

   .avatar:hover {
       border-color: rgba(11, 222, 249, 0.6);
   }

   .user-info {
       display: flex;
       flex-direction: column;
       align-items: flex-start;
       gap: 2px;
   }

   .user-name {
       font-weight: 500;
       color: var(--text-color);
       font-size: 14px;
       margin: 0;
       line-height: 1.2;
   }

   .user-email {
       color: var(--text-secondary);
       font-size: 12px;
       margin: 0;
       line-height: 1.2;
   }

   /* Main Content */
   .main-content {
       flex: 1;
       display: flex;
       flex-direction: column;
       margin-left: var(--sidebar-width);
       transition: margin-left 0.3s ease;
   }

   .sidebar.collapsed ~ .main-content {
       margin-left: 80px;
   }

   .main-content.expanded {
       margin-left: 0;
   }

   .content-container {
       padding: 30px;
       flex: 1;
       margin-top: var(--header-height);
   }

   /* Stats Cards */
   .stats-cards,
   .dashboard-cards {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
       gap: 20px;
       margin-bottom: 30px;
   }

   .stats-card,
   .dashboard-card {
       background-color: var(--chart-bg);
       border: 1px solid var(--border-color);
       border-radius: 8px;
       padding: 20px;
       box-shadow: var(--shadow);
       transition: all 0.3s ease;
       display: flex;
       flex-direction: column;
       align-items: center;
       text-align: center;
       position: relative;
       overflow: hidden;
   }

   .stats-card:hover,
   .dashboard-card:hover {
       transform: translateY(-3px);
       box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
   }

   .stats-icon,
   .card-icon {
       font-size: 2rem;
       margin-bottom: 15px;
       color: var(--blue-color);
       position: absolute;
       top: 20px;
       right: 20px;
       width: 40px;
       height: 40px;
       border-radius: 50%;
       display: flex;
       align-items: center;
       justify-content: center;
       color: white;
   }

   .stats-number,
   .card-value {
       font-size: 1.8rem;
       font-weight: bold;
       margin-bottom: 5px;
       color: var(--text-color);
       margin: 10px 0;
   }

   .stats-label,
   .card-title {
       font-size: 0.9rem;
       color: var(--text-secondary);
   }

   /* Priority Classes */
   .high-priority {
       background-color: rgba(40, 199, 111, 0.1);
       border: 1px solid rgba(40, 199, 111, 0.3);
   }

   .high-priority .stats-icon {
       background-color: #28c76f;
   }

   .medium-priority {
       background-color: rgba(25, 118, 210, 0.1);
       border: 1px solid rgba(25, 118, 210, 0.3);
   }

   .medium-priority .stats-icon {
       background-color: var(--blue-color);
   }

   .low-priority {
       background-color: rgba(255, 159, 67, 0.1);
       border: 1px solid rgba(255, 159, 67, 0.3);
   }

   .low-priority .stats-icon {
       background-color: #ff9f43;
   }

   /* Dark Mode Overrides */
   body.dark-mode .high-priority {
       background-color: rgba(40, 199, 111, 0.2);
   }

   body.dark-mode .medium-priority {
       background-color: rgba(25, 118, 210, 0.2);
   }

   body.dark-mode .low-priority {
       background-color: rgba(255, 159, 67, 0.2);
   }

   /* Charts */
   .charts-grid {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
       gap: 20px;
       margin-bottom: 30px;
   }

   .chart-card,
   .chart-container {
       background-color: var(--chart-bg);
       border: 1px solid var(--border-color);
       border-radius: 8px;
       padding: 20px;
       box-shadow: var(--shadow);
       transition: all 0.3s ease;
       margin-bottom: 20px;
   }

   .chart-card:hover,
   .chart-container:hover {
       transform: translateY(-3px);
       box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
   }

   .chart-title {
       font-size: 1.2rem;
       font-weight: 500;
       color: var(--text-color);
       margin-bottom: 10px;
       text-align: center;
   }

   .chart-description {
       font-size: 0.9rem;
       color: var(--text-secondary);
       margin-bottom: 15px;
   }

   .chart-wrapper {
       position: relative;
       height: 300px;
       width: 100%;
   }

   .full-width-chart .chart-wrapper {
       height: 400px;
   }

   /* Activity Feed */
   .activity-feed {
       background: var(--chart-bg);
       border-radius: 8px;
       padding: 20px;
       box-shadow: var(--shadow);
       margin-bottom: 20px;
   }

   .activity-item {
       display: flex;
       align-items: center;
       padding: 15px 0;
       border-bottom: 1px solid var(--border-color);
   }

   .activity-item:last-child {
       border-bottom: none;
   }

   .activity-icon {
       width: 40px;
       height: 40px;
       border-radius: 50%;
       background-color: var(--blue-color);
       display: flex;
       align-items: center;
       justify-content: center;
       color: white;
       margin-right: 15px;
   }

   .activity-title {
       font-weight: bold;
       color: var(--text-color);
   }

   .activity-time {
       color: var(--text-secondary);
   }

   /* Buttons */
   .refresh-btn,
   .btn {
       background: var(--blue-color);
       color: white;
       border: none;
       padding: 12px 25px;
       border-radius: 8px;
       font-size: 1rem;
       cursor: pointer;
       transition: all 0.3s ease;
       margin: 20px auto;
       display: block;
       box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
   }

   .refresh-btn:hover,
   .btn:hover {
       background: #1565c0;
       transform: translateY(-2px);
   }

   .btn-primary {
       background-color: var(--blue-color);
   }

   .btn-primary:hover {
       background-color: #1565c0;
   }

   .btn-danger {
       background-color: var(--red-color);
   }

   .btn-danger:hover {
       background-color: rgba(11, 222, 249, 0.8);
   }

   .btn-success {
       background-color: var(--green-color);
   }

   .btn-success:hover {
       background-color: #2e7d32;
   }

   .btn-warning {
       background-color: #ffa000;
   }

   .btn-warning:hover {
       background-color: #ff8f00;
   }

   /* Loading & Error States */
   .loading {
       text-align: center;
       padding: 40px;
       font-size: 1rem;
       color: var(--text-secondary);
       display: flex;
       flex-direction: column;
       align-items: center;
       gap: 10px;
   }

   .loading i {
       font-size: 1.5rem;
       animation: spin 1s linear infinite;
       color: var(--red-color);
   }

   @keyframes spin {
       0% { transform: rotate(0deg); }
       100% { transform: rotate(360deg); }
   }

   .error {
       background: #ea5455;
       color: white;
       padding: 15px;
       border-radius: 8px;
       margin: 20px 0;
       text-align: center;
   }

   /* Animations */
   .section {
       display: none;
       animation: fadeIn 0.5s ease;
   }

   .section.active {
       display: block;
   }

   @keyframes fadeIn {
       from { opacity: 0; }
       to { opacity: 1; }
   }

   @keyframes fadeInUp {
       from {
           opacity: 0;
           transform: translateY(30px);
       }
       to {
           opacity: 1;
           transform: translateY(0);
       }
   }

   .stats-card, .chart-container, .activity-feed {
       animation: fadeInUp 0.6s ease-out;
   }

   /* Responsive Design */
   @media (max-width: 992px) {
       .sidebar {
           width: 70px;
           overflow: visible;
       }

       .sidebar .menu-text,
       .sidebar .nav-item span {
           display: none;
       }

       .main-content {
           margin-left: 70px;
       }

       .main-content.expanded {
           margin-left: 0;
       }

       .header {
           left: 70px;
       }

       .sidebar-menu i,
       .nav-item i {
           margin-right: 0;
           font-size: 20px;
       }

       .sidebar-menu a,
       .nav-item {
           padding: 15px;
           justify-content: center;
       }

       .user-info {
           display: none;
       }

       .profile-container {
           padding: 8px;
           border-radius: 50%;
       }

       .search-container {
           width: 200px;
       }
   }

   @media (max-width: 768px) {
       .stats-cards,
       .dashboard-cards {
           grid-template-columns: 1fr 1fr;
       }

       .charts-grid {
           grid-template-columns: 1fr;
       }

       .header-title {
           font-size: 16px;
       }

       .logo-text {
           font-size: 18px;
       }

       .logo-image {
           width: 32px;
           height: 32px;
       }

       .sidebar {
           transform: translateX(-100%);
           z-index: 1001;
       }

       .sidebar:not(.collapsed) {
           transform: translateX(0);
       }

       .main-content {
           margin-left: 0;
       }

       .header {
           left: 0;
       }
   }

   @media (max-width: 576px) {
       .stats-cards,
       .dashboard-cards {
           grid-template-columns: 1fr;
       }

       .content-container {
           padding: 15px;
       }

       .search-container {
           display: none;
       }

       .header-title {
           display: none;
       }

       .header {
           padding: 0 15px;
       }
   }

   /* Utility Classes */
   .text-center {
       text-align: center;
   }

   .mb-3 {
       margin-bottom: 1rem;
   }

   .mb-4 {
       margin-bottom: 1.5rem;
   }

   .d-flex {
       display: flex;
   }

   .align-items-center {
       align-items: center;
   }

   .justify-content-between {
       justify-content: space-between;
   }

   .gap-3 {
       gap: 1rem;
   }

   .container-fluid {
       width: 100%;
       padding: 0;
   }

   /* Custom Scrollbar */
   .sidebar::-webkit-scrollbar {
       width: 6px;
   }

   .sidebar::-webkit-scrollbar-track {
       background: var(--bg-color);
   }

   .sidebar::-webkit-scrollbar-thumb {
       background: var(--border-color);
       border-radius: 3px;
   }

   .sidebar::-webkit-scrollbar-thumb:hover {
       background: var(--text-secondary);
   }




        /* CSS Compl√©mentaire pour Main Content, Stats Cards et Tables */

/* Main Content Layout */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    margin-left: var(--sidebar-width);
    transition: margin-left 0.3s ease;
    min-height: 100vh;
    background-color: var(--bg-color);
}

.sidebar.collapsed ~ .main-content {
    margin-left: 80px;
}

.main-content.expanded {
    margin-left: 0;
}

/* Container Fluid */
.container-fluid {
    width: 100%;
    padding: 0 30px;
    margin-top: var(--header-height);
    padding-top: 30px;
    flex: 1;
}

/* Bootstrap Grid System */
.row {
    display: flex;
    flex-wrap: wrap;
    margin: 0 -10px;
}

.col-lg-4,
.col-md-6,
.col-sm-12 {
    padding: 0 10px;
    margin-bottom: 20px;
}

.col-lg-4 {
    flex: 0 0 33.333333%;
    max-width: 33.333333%;
}

.col-md-6 {
    flex: 0 0 50%;
    max-width: 50%;
}

.col-sm-12 {
    flex: 0 0 100%;
    max-width: 100%;
}

/* Stats Cards Container */
.stats-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
}

.stats-cards .col-lg-4,
.stats-cards .col-md-6 {
    flex: 1;
    min-width: 280px;
}

/* Stats Card Enhanced */
.stats-card {
    background-color: var(--chart-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 25px;
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    height: 140px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--red-color), var(--blue-color));
    border-radius: 12px 12px 0 0;
}

.stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.stats-icon {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    background: var(--blue-color);
}

.stats-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stats-number {
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--text-color);
    margin-bottom: 5px;
    line-height: 1;
}

.stats-change {
    font-size: 0.85rem;
    color: var(--green-color);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 4px;
}

.stats-change i {
    font-size: 0.8rem;
}

/* Priority Classes Enhanced */
.high-priority {
    background: linear-gradient(135deg, rgba(40, 199, 111, 0.05) 0%, rgba(40, 199, 111, 0.15) 100%);
    border: 1px solid rgba(40, 199, 111, 0.2);
}

.high-priority .stats-icon {
    background: linear-gradient(135deg, #28c76f, #20bf6b);
}

.medium-priority {
    background: linear-gradient(135deg, rgba(25, 118, 210, 0.05) 0%, rgba(25, 118, 210, 0.15) 100%);
    border: 1px solid rgba(25, 118, 210, 0.2);
}

.medium-priority .stats-icon {
    background: linear-gradient(135deg, var(--blue-color), #1565c0);
}

.low-priority {
    background: linear-gradient(135deg, rgba(255, 159, 67, 0.05) 0%, rgba(255, 159, 67, 0.15) 100%);
    border: 1px solid rgba(255, 159, 67, 0.2);
}

.low-priority .stats-icon {
    background: linear-gradient(135deg, #ff9f43, #ff8c00);
}

/* Table Container */
.table-container {
    background-color: var(--chart-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 0;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    overflow: hidden;
}

/* Table Actions */
.table-actions {
    padding: 25px 30px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    background-color: rgba(11, 222, 249, 0.02);
}

.table-actions .btn {
    border-radius: 8px;
    font-weight: 500;
    padding: 10px 20px;
    border: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
}

.table-actions .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Form Controls */
.form-control {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 10px 15px;
    font-size: 0.9rem;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: all 0.3s ease;
    outline: none;
}

.form-control:focus {
    border-color: var(--blue-color);
    box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    background-color: var(--chart-bg);
}

.form-control::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
}

/* Input Group */
.input-group {
    display: flex;
    align-items: stretch;
    position: relative;
    width: 300px;
}

.input-group .form-control {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    border-right: none;
    flex: 1;
}

.input-group .btn {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    border-left: 1px solid var(--border-color);
}

/* Button Styles */
.btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
    line-height: 1.5;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-primary {
    background: linear-gradient(135deg, var(--blue-color), #1565c0);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #1565c0, #0d47a1);
}

.btn-outline-primary {
    background: transparent;
    border: 1px solid var(--blue-color);
    color: var(--blue-color);
}

.btn-outline-primary:hover {
    background: var(--blue-color);
    color: white;
}

.btn-outline-secondary {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
}

.btn-outline-secondary:hover {
    background: var(--hover-bg);
    color: var(--text-color);
}

.btn-success {
    background: linear-gradient(135deg, var(--green-color), #2e7d32);
    color: white;
}

.btn-success:hover {
    background: linear-gradient(135deg, #2e7d32, #1b5e20);
}

.btn-danger {
    background: linear-gradient(135deg, #ea5455, #d32f2f);
    color: white;
}

.btn-danger:hover {
    background: linear-gradient(135deg, #d32f2f, #b71c1c);
}

.btn-warning {
    background: linear-gradient(135deg, #ffa000, #ff8f00);
    color: white;
}

.btn-warning:hover {
    background: linear-gradient(135deg, #ff8f00, #e65100);
}

/* Utility Classes */
.d-flex {
    display: flex !important;
}

.align-items-center {
    align-items: center !important;
}

.justify-content-between {
    justify-content: space-between !important;
}

.gap-2 {
    gap: 0.5rem !important;
}

.gap-3 {
    gap: 1rem !important;
}

.me-1 {
    margin-right: 0.25rem !important;
}

.me-2 {
    margin-right: 0.5rem !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.mb-4 {
    margin-bottom: 1.5rem !important;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .col-lg-4 {
        flex: 0 0 50%;
        max-width: 50%;
    }
}

@media (max-width: 992px) {
    .container-fluid {
        padding: 0 20px;
        padding-top: 20px;
    }

    .stats-cards {
        gap: 15px;
    }

    .stats-card {
        height: 130px;
        padding: 20px;
    }

    .stats-number {
        font-size: 1.8rem;
    }

    .table-actions {
        padding: 20px;
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }

    .input-group {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .col-lg-4,
    .col-md-6 {
        flex: 0 0 100%;
        max-width: 100%;
    }

    .stats-cards .col-lg-4,
    .stats-cards .col-md-6 {
        min-width: auto;
    }

    .container-fluid {
        padding: 0 15px;
        padding-top: 15px;
    }

    .stats-card {
        height: 120px;
        padding: 18px;
    }

    .stats-icon {
        width: 45px;
        height: 45px;
        font-size: 1.3rem;
    }

    .stats-number {
        font-size: 1.6rem;
    }

    .table-actions {
        padding: 15px;
    }

    .table-actions .btn {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 576px) {
    .container-fluid {
        padding: 0 10px;
        padding-top: 10px;
    }

    .stats-cards {
        gap: 10px;
    }

    .stats-card {
        height: 110px;
        padding: 15px;
    }

    .stats-icon {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
        top: 15px;
        right: 15px;
    }

    .stats-number {
        font-size: 1.4rem;
    }

    .stats-label {
        font-size: 0.8rem;
    }

    .table-container {
        border-radius: 8px;
    }

    .table-actions {
        padding: 12px;
    }
}

/* Dark Mode Adjustments */
body.dark-mode .table-actions {
    background-color: rgba(11, 222, 249, 0.05);
}

body.dark-mode .form-control {
    background-color: var(--bg-color);
    border-color: var(--border-color);
    color: var(--text-color);
}

body.dark-mode .form-control:focus {
    background-color: var(--sidebar-bg);
    border-color: var(--blue-color);
}

body.dark-mode .btn-outline-secondary {
    border-color: var(--border-color);
    color: var(--text-secondary);
}

body.dark-mode .btn-outline-secondary:hover {
    background-color: var(--hover-bg);
    color: var(--text-color);
}

/* Animation Enhancements */
.stats-card {
    animation: slideInUp 0.6s ease-out;
}

.stats-card:nth-child(1) {
    animation-delay: 0.1s;
}

.stats-card:nth-child(2) {
    animation-delay: 0.2s;
}

.stats-card:nth-child(3) {
    animation-delay: 0.3s;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Table Container Animation */
.table-container {
    animation: fadeInUp 0.6s ease-out 0.4s both;
}
    </style>
</head>
<body>
<header class="header">
    <div class="header-left">
        <div class="logo">
            <img src="images/logoImas.jpg" alt="PMMS Logo" class="logo-image">
            <span class="logo-text"></span>
        </div>
        <button class="header-btn" id="sidebarToggle" title="Toggle Sidebar">
            <i class="bi bi-list"></i>
            <span class="btn-text">Menu</span>
        </button>
    </div>
    <div class="header-center">
        <div class="header-title">Staff Analytics Dashboard</div>
    </div>
    <div class="header-right">
        <div class="header-buttons">
            <button class="header-btn" id="themeToggle" title="Toggle Theme">
                <i class="bi bi-sun"></i>
                <span class="btn-text">Light</span>
            </button>
        </div>
        <div class="profile-container">
            <div class="profile-image">
                <img src="images/default-avatar.png" alt="User Profile" class="avatar">
            </div>
            <div class="user-info">
                <h3 class="user-name">Loading...</h3>
                <p class="user-email">Loading...</p>
            </div>
        </div>
        <div class="dropdown-menu user-dropdown" aria-labelledby="userProfile">
            <a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profile</a>
            <a class="dropdown-item" href="#"><i class="bi bi-gear"></i> Settings</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right"></i> Logout</a>
        </div>
    </div>
</header>

<nav class="sidebar" id="sidebar">
    <ul class="sidebar-menu">
        <li>
            <a href="Staffanalyse.html">
                <i class="bi bi-speedometer2"></i>
                <span class="menu-text">Dashboard</span>
            </a>
        </li>
        <li>
            <a href="CrudMaintenancePlan.html">
                <i class="bi bi-wrench-adjustable"></i>
                <span class="menu-text">Maintenance</span>
            </a>
        </li>
        <li>
            <a href="InventoryReport.html">
                <i class="bi bi-bar-chart-line"></i>
                <span class="menu-text">Inventory Statistics</span>
            </a>
        </li>
        <li>
            <a href="Planning.html" class="active">
                <i class="bi bi-calendar-event"></i>
                <span class="menu-text">Planning</span>
            </a>
        </li>
        <li>
            <a href="CrudEquipment.html">
                <i class="bi bi-cpu"></i>
                <span class="menu-text">Equipment</span>
            </a>
        </li>
        <li>
            <a href="TaskManager.html">
                <i class="bi bi-list-task"></i>
                <span class="menu-text">Task</span>
            </a>
        </li>
        <li>
            <a href="CrudStaff.html">
                <i class="bi bi-people"></i>
                <span class="menu-text">Staff</span>
            </a>
        </li>
        <li>
            <a href="Technician.html">
                <i class="bi bi-person-gear"></i>
                <span class="menu-text">Technician</span>
            </a>
        </li>
        <li>
            <a href="EquipmentStatistics.html">
                <i class="bi bi-pie-chart"></i>
                <span class="menu-text">Equipment Statistics</span>
            </a>
        </li>
        <li>
            <a href="DowntimeEvent.html">
                <i class="bi bi-exclamation-triangle"></i>
                <span class="menu-text">Downtime</span>
            </a>
        </li>
        <li>
            <a href="WhatsApp.html">
                <i class="bi bi-whatsapp"></i>
                <span class="menu-text">Communication</span>
            </a>
        </li>
        <li>
            <a href="TechnicianStatistics.html">
                <i class="bi bi-graph-up-arrow"></i>
                <span class="menu-text">Technician Statistics</span>
            </a>
        </li>
        <li>
            <a href="CrudInventory.html">
                <i class="bi bi-boxes"></i>
                <span class="menu-text">Inventory</span>
            </a>
        </li>
        <li>
            <a href="CrudSparePart.html">
                <i class="bi bi-tools"></i>
                <span class="menu-text">Spare Part Management</span>
            </a>
        </li>
        <li>
            <a href="MaintenancePDFReport.html">
                <i class="bi bi-file-earmark-text"></i>
                <span class="menu-text">Reporting</span>
            </a>
        </li>
        <li>
            <a href="login.html">
                <i class="bi bi-box-arrow-right"></i>
                <span class="menu-text">Logout</span>
            </a>
        </li>
    </ul>
</nav>




<!-- Main Content -->
<main class="main-content">
    <div class="container-fluid">
        <!-- Stats Cards -->
        <div class="row stats-cards g-3 mb-4">
            <div class="col-lg-3 col-md-6">
                <div class="stats-card high-priority">
                    <div class="stats-icon">
                        <i class="bi bi-boxes"></i>
                    </div>
                    <div class="stats-label">Total Items</div>
                    <div class="stats-number" id="totalItems">0</div>
                    <div class="stats-change">
                        <i class="bi bi-arrow-up me-1"></i> <span id="totalItemsChange">0%</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stats-card medium-priority">
                    <div class="stats-icon">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="stats-label">Available Stock</div>
                    <div class="stats-number" id="availableStock">0</div>
                    <div class="stats-change">
                        <i class="bi bi-arrow-up me-1"></i> <span id="availableStockChange">0%</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stats-card warning-priority">
                    <div class="stats-icon">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div class="stats-label">Low Stock Items</div>
                    <div class="stats-number" id="lowStockItems">0</div>
                    <div class="stats-change">
                        <i class="bi bi-arrow-down me-1"></i> <span id="lowStockChange">0%</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stats-card success-priority">
                    <div class="stats-icon">
                        <i class="bi bi-currency-dollar"></i>
                    </div>
                    <div class="stats-label">Total Value</div>
                    <div class="stats-number" id="totalValue">$0</div>
                    <div class="stats-change">
                        <i class="bi bi-arrow-up me-1"></i> <span id="totalValueChange">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter and Actions Bar -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <select class="form-select" id="typeFilter">
                                    <option value="">All Types</option>
                                    <option value="EQUIPMENT">Equipment</option>
                                    <option value="SPARE_PART">Spare Part</option>
                                    <option value="CONSUMABLE">Consumable</option>
                                    <option value="TOOL">Tool</option>
                                    <option value="ACCESSORY">Accessory</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="statusFilter">
                                    <option value="">All Status</option>
                                    <option value="ACTIVE">Active</option>
                                    <option value="INACTIVE">Inactive</option>
                                    <option value="DISCONTINUED">Discontinued</option>
                                    <option value="OBSOLETE">Obsolete</option>
                                    <option value="UNDER_REVIEW">Under Review</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="text" id="searchInventoryInput" class="form-control" placeholder="Search inventory...">
                                    <button class="btn btn-outline-secondary" type="button" id="searchInventoryButton">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-warning" id="showLowStockBtn" title="Show Low Stock">
                                        <i class="bi bi-exclamation-triangle"></i>
                                    </button>
                                    <button class="btn btn-outline-info" id="showOverStockBtn" title="Show Overstock">
                                        <i class="bi bi-arrow-up-circle"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Table -->
        <div class="table-container">
            <div class="table-actions">
                <button class="btn btn-primary" id="addInventoryBtn">
                    <i class="bi bi-plus-circle me-2"></i> New Inventory Item
                </button>
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-outline-success" id="exportInventoryBtn">
                        <i class="bi bi-download me-1"></i> Export
                    </button>
                    <button class="btn btn-outline-info" id="refreshInventoryBtn">
                        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="data-table table">
                    <thead>
                    <tr>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Location</th>
                        <th>Total Qty</th>
                        <th>Available</th>
                        <th>Reserved</th>
                        <th>Status</th>
                        <th>Unit Cost</th>
                        <th>Total Value</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                    <!-- Inventory data will be populated here dynamically -->
                    </tbody>
                </table>
            </div>

            <div id="inventoryPagination" class="d-flex justify-content-between align-items-center mt-3">
                <div>
                    Showing <span id="showingEntries">0-0</span> of <span id="totalEntries">0</span> entries
                </div>
                <nav aria-label="Page navigation">
                    <ul class="pagination mb-0" id="paginationLinks">
                        <!-- Pagination will be generated dynamically -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</main>

<!-- Inventory Modal -->
<div class="modal fade" id="inventoryModal" tabindex="-1" aria-labelledby="inventoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inventoryModalLabel">Add New Inventory Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="inventoryForm">
                    <input type="hidden" id="inventoryId">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="inventoryCode" class="form-label">Inventory Code *</label>
                                <input type="text" class="form-control" id="inventoryCode" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Name *</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="itemType" class="form-label">Item Type *</label>
                                <select class="form-select" id="itemType" required>
                                    <option value="">Select Type</option>
                                    <option value="EQUIPMENT">Equipment</option>
                                    <option value="SPARE_PART">Spare Part</option>
                                    <option value="CONSUMABLE">Consumable</option>
                                    <option value="TOOL">Tool</option>
                                    <option value="ACCESSORY">Accessory</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="status" class="form-label">Status *</label>
                                <select class="form-select" id="status" required>
                                    <option value="">Select Status</option>
                                    <option value="ACTIVE">Active</option>
                                    <option value="INACTIVE">Inactive</option>
                                    <option value="DISCONTINUED">Discontinued</option>
                                    <option value="OBSOLETE">Obsolete</option>
                                    <option value="UNDER_REVIEW">Under Review</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="location">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="category" class="form-label">Category</label>
                                <input type="text" class="form-control" id="category">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="totalQuantity" class="form-label">Total Quantity *</label>
                                <input type="number" class="form-control" id="totalQuantity" required min="0">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="minimumThreshold" class="form-label">Min Threshold</label>
                                <input type="number" class="form-control" id="minimumThreshold" min="0">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="maximumThreshold" class="form-label">Max Threshold</label>
                                <input type="number" class="form-control" id="maximumThreshold" min="0">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="unitCost" class="form-label">Unit Cost</label>
                                <input type="number" class="form-control" id="unitCost" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="totalValue" class="form-label">Total Value (Auto-calculated)</label>
                                <input type="number" class="form-control" id="totalValue" step="0.01" readonly>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveInventoryBtn">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Stock Operations Modal -->
<div class="modal fade" id="stockOperationModal" tabindex="-1" aria-labelledby="stockOperationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="stockOperationModalLabel">Stock Operation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="stockOperationForm">
                    <input type="hidden" id="stockInventoryId">
                    <input type="hidden" id="stockOperation">
                    <div class="mb-3">
                        <label class="form-label">Item Information</label>
                        <div class="card bg-light">
                            <div class="card-body">
                                <strong id="stockItemName">Item Name</strong><br>
                                <small class="text-muted">Code: <span id="stockItemCode">Code</span></small><br>
                                <small class="text-muted">Available: <span id="stockAvailable">0</span> | Reserved: <span id="stockReserved">0</span></small>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="stockQuantity" class="form-label">Quantity *</label>
                        <input type="number" class="form-control" id="stockQuantity" required min="1">
                    </div>
                    <div class="mb-3">
                        <label for="stockReason" class="form-label">Reason *</label>
                        <input type="text" class="form-control" id="stockReason" required>
                    </div>
                    <div class="mb-3">
                        <label for="stockPerformedBy" class="form-label">Performed By *</label>
                        <input type="text" class="form-control" id="stockPerformedBy" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="executeStockOperationBtn">Execute</button>
            </div>
        </div>
    </div>
</div>

<!-- Inventory Details Modal -->
<div class="modal fade" id="inventoryDetailsModal" tabindex="-1" aria-labelledby="inventoryDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inventoryDetailsModalLabel">Inventory Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Code:</strong> <span id="detailsCode">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Name:</strong> <span id="detailsName">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Description:</strong> <span id="detailsDescription">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Type:</strong> <span id="detailsType">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Status:</strong> <span id="detailsStatus">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Location:</strong> <span id="detailsLocation">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Category:</strong> <span id="detailsCategory">--</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Total Quantity:</strong> <span id="detailsTotalQuantity">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Available:</strong> <span id="detailsAvailableQuantity">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Reserved:</strong> <span id="detailsReservedQuantity">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Min Threshold:</strong> <span id="detailsMinThreshold">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Max Threshold:</strong> <span id="detailsMaxThreshold">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Unit Cost:</strong> <span id="detailsUnitCost">--</span>
                        </div>
                        <div class="mb-3">
                            <strong>Total Value:</strong> <span id="detailsTotalValue">--</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <strong>Stock Level:</strong>
                        <div class="progress mt-2">
                            <div class="progress-bar" id="detailsStockProgress" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted">Created: <span id="detailsCreatedDate">--</span> | Last Updated: <span id="detailsLastUpdated">--</span></small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="editFromDetailsBtn">Edit</button>
                <button type="button" class="btn btn-info" id="viewTransactionsBtn">View Transactions</button>
            </div>
        </div>
    </div>
</div>

<!-- Transactions Modal -->
<div class="modal fade" id="transactionsModal" tabindex="-1" aria-labelledby="transactionsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="transactionsModalLabel">Transaction History</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Quantity</th>
                            <th>Reason</th>
                            <th>Performed By</th>
                        </tr>
                        </thead>
                        <tbody id="transactionsTableBody">
                        <!-- Transactions will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this inventory item? This action cannot be undone.</p>
                <p><strong>Item: </strong><span id="deleteItemName">--</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
    <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-info-circle me-2"></i>
            <strong class="me-auto" id="toastTitle">Notification</strong>
            <small>Just now</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Action completed successfully.
        </div>
    </div>
</div>
<script src="js/user_session_handler.js"></script>
<script src="js/SessionTracker.js"></script>

<style>
    .stats-cards {
        margin-bottom: 2rem;
    }

    .stats-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid;
        transition: transform 0.2s;
    }

    .stats-card:hover {
        transform: translateY(-2px);
    }

    .stats-card.high-priority {
        border-left-color: #007bff;
    }

    .stats-card.medium-priority {
        border-left-color: #28a745;
    }

    .stats-card.warning-priority {
        border-left-color: #ffc107;
    }

    .stats-card.success-priority {
        border-left-color: #17a2b8;
    }

    .stats-icon {
        font-size: 2rem;
        color: #6c757d;
        margin-bottom: 0.5rem;
    }

    .stats-label {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }

    .stats-number {
        font-size: 2rem;
        font-weight: bold;
        color: #495057;
        margin-bottom: 0.25rem;
    }

    .stats-change {
        font-size: 0.75rem;
        color: #28a745;
    }

    .table-container {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .table-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .data-table {
        margin-bottom: 0;
    }

    .data-table th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
        font-weight: 600;
    }

    .badge {
        font-size: 0.75rem;
    }

    .btn-group-sm .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
    }

    .toast {
        min-width: 300px;
    }

    .progress {
        height: 10px;
    }

    .stock-low {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
    }

    .stock-high {
        background-color: #d1ecf1;
        border-left: 4px solid #17a2b8;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

<script>
    class InventoryManager {
        constructor() {
            this.baseUrl = '/api/inventory';
            this.currentPage = 1;
            this.pageSize = 10;
            this.totalItems = 0;
            this.inventoryData = [];
            this.filteredData = [];
            this.init();
        }

        init() {
            this.bindEvents();
            this.loadInventoryData();
            this.loadStats();
        }

        bindEvents() {
            // Add inventory button
            document.getElementById('addInventoryBtn').addEventListener('click', () => {
                this.showInventoryModal();
            });

            // Save inventory button
            document.getElementById('saveInventoryBtn').addEventListener('click', () => {
                this.saveInventory();
            });

            // Search functionality
            document.getElementById('searchInventoryButton').addEventListener('click', () => {
                this.performSearch();
            });

            document.getElementById('searchInventoryInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.performSearch();
                }
            });

            // Filter functionality
            document.getElementById('typeFilter').addEventListener('change', () => {
                this.applyFilters();
            });

            document.getElementById('statusFilter').addEventListener('change', () => {
                this.applyFilters();
            });

            // Special filter buttons
            document.getElementById('showLowStockBtn').addEventListener('click', () => {
                this.showLowStock();
            });

            document.getElementById('showOverStockBtn').addEventListener('click', () => {
                this.showOverStock();
            });

            // Refresh button
            document.getElementById('refreshInventoryBtn').addEventListener('click', () => {
                this.loadInventoryData();
                this.loadStats();
            });

            // Export button
            document.getElementById('exportInventoryBtn').addEventListener('click', () => {
                this.exportToCSV();
            });

            // Delete confirmation
            document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
                this.confirmDelete();
            });

            // Stock operation
            document.getElementById('executeStockOperationBtn').addEventListener('click', () => {
                this.executeStockOperation();
            });

            // Edit from details
            document.getElementById('editFromDetailsBtn').addEventListener('click', () => {
                const id = document.getElementById('inventoryDetailsModal').dataset.itemId;
                this.editInventory(id);
            });

            // View transactions
            document.getElementById('viewTransactionsBtn').addEventListener('click', () => {
                const id = document.getElementById('inventoryDetailsModal').dataset.itemId;
                this.viewTransactions(id);
            });

            // Auto-calculate total value
            document.getElementById('unitCost').addEventListener('input', this.calculateTotalValue);
            document.getElementById('totalQuantity').addEventListener('input', this.calculateTotalValue);
        }

        calculateTotalValue() {
            const unitCost = parseFloat(document.getElementById('unitCost').value) || 0;
            const totalQuantity = parseInt(document.getElementById('totalQuantity').value) || 0;
            const totalValue = unitCost * totalQuantity;
            document.getElementById('totalValue').value = totalValue.toFixed(2);
        }

        async loadInventoryData() {
            try {
                const response = await fetch(this.baseUrl);
                if (response.ok) {
                    this.inventoryData = await response.json();
                    this.filteredData = [...this.inventoryData];
                    this.renderTable();
                    this.updatePagination();
                } else {
                    this.showToast('Error', 'Failed to load inventory data', 'error');
                }
            } catch (error) {
                console.error('Error loading inventory:', error);
                this.showToast('Error', 'Failed to connect to server', 'error');
            }
        }





    async loadStats() {
        try {
            // Load total value
            const valueResponse = await fetch(`${this.baseUrl}/total-value`);
            const totalValue = valueResponse.ok ? await valueResponse.json() : 0;

            // Load low stock items
            const lowStockResponse = await fetch(`${this.baseUrl}/low-stock`);
            const lowStockItems = lowStockResponse.ok ? await lowStockResponse.json() : [];

            // Load overstock items
            const overStockResponse = await fetch(`${this.baseUrl}/overstock`);
            const overStockItems = overStockResponse.ok ? await overStockResponse.json() : [];

            // Calculate stats
            const totalItems = this.inventoryData.length;
            const totalAvailableStock = this.inventoryData.reduce((sum, item) => sum + item.availableQuantity, 0);

            // Update stats display
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('availableStock').textContent = totalAvailableStock;
            document.getElementById('lowStockItems').textContent = lowStockItems.length;
            document.getElementById('totalValue').textContent = `$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2})}`;

        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }

    renderTable() {
        const tbody = document.getElementById('inventoryTableBody');
        const startIndex = (this.currentPage - 1) * this.pageSize;
        const endIndex = startIndex + this.pageSize;
        const paginatedData = this.filteredData.slice(startIndex, endIndex);

        tbody.innerHTML = '';

        paginatedData.forEach(item => {
            const row = this.createTableRow(item);
            tbody.appendChild(row);
        });

        this.updatePaginationInfo();
    }

    createTableRow(item) {
        const row = document.createElement('tr');

        // Apply stock level styling
        if (item.minimumThreshold && item.totalQuantity <= item.minimumThreshold) {
            row.classList.add('stock-low');
        } else if (item.maximumThreshold && item.totalQuantity >= item.maximumThreshold) {
            row.classList.add('stock-high');
        }

        const statusBadgeClass = this.getStatusBadgeClass(item.status);
        const typeBadgeClass = this.getTypeBadgeClass(item.itemType);

        row.innerHTML = `
            <td>${item.inventoryCode}</td>
            <td>${item.name}</td>
            <td><span class="badge ${typeBadgeClass}">${item.itemType.replace('_', ' ')}</span></td>
            <td>${item.category || '-'}</td>
            <td>${item.location || '-'}</td>
            <td>${item.totalQuantity}</td>
            <td>${item.availableQuantity}</td>
            <td>${item.reservedQuantity}</td>
            <td><span class="badge ${statusBadgeClass}">${item.status.replace('_', ' ')}</span></td>
            <td>${item.unitCost ? '$' + item.unitCost.toFixed(2) : '-'}</td>
            <td>${item.totalValue ? '$' + item.totalValue.toFixed(2) : '-'}</td>
            <td>
                <div class="btn-group btn-group-sm" role="group">
                    <button class="btn btn-outline-primary" onclick="inventoryManager.viewDetails(${item.inventoryId})" title="View Details">
                        <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-outline-secondary" onclick="inventoryManager.editInventory(${item.inventoryId})" title="Edit">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown" title="Stock Operations">
                            <i class="bi bi-boxes"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" onclick="inventoryManager.showStockOperation(${item.inventoryId}, 'add')">Add Stock</a></li>
                            <li><a class="dropdown-item" onclick="inventoryManager.showStockOperation(${item.inventoryId}, 'remove')">Remove Stock</a></li>
                            <li><a class="dropdown-item" onclick="inventoryManager.showStockOperation(${item.inventoryId}, 'reserve')">Reserve Stock</a></li>
                        </ul>
                    </div>
                    <button class="btn btn-outline-danger" onclick="inventoryManager.deleteInventory(${item.inventoryId})" title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </td>
        `;

        return row;
    }

    getStatusBadgeClass(status) {
        const statusClasses = {
            'ACTIVE': 'bg-success',
            'INACTIVE': 'bg-secondary',
            'DISCONTINUED': 'bg-warning',
            'OBSOLETE': 'bg-danger',
            'UNDER_REVIEW': 'bg-info'
        };
        return statusClasses[status] || 'bg-secondary';
    }

    getTypeBadgeClass(type) {
        const typeClasses = {
            'EQUIPMENT': 'bg-primary',
            'SPARE_PART': 'bg-success',
            'CONSUMABLE': 'bg-warning',
            'TOOL': 'bg-info',
            'ACCESSORY': 'bg-secondary'
        };
        return typeClasses[type] || 'bg-secondary';
    }

    updatePagination() {
        this.totalItems = this.filteredData.length;
        const totalPages = Math.ceil(this.totalItems / this.pageSize);
        const paginationContainer = document.getElementById('paginationLinks');

        paginationContainer.innerHTML = '';

        // Previous button
        const prevBtn = document.createElement('li');
        prevBtn.className = `page-item ${this.currentPage === 1 ? 'disabled' : ''}`;
        prevBtn.innerHTML = `<a class="page-link" href="#" onclick="inventoryManager.changePage(${this.currentPage - 1})">Previous</a>`;
        paginationContainer.appendChild(prevBtn);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                const pageBtn = document.createElement('li');
                pageBtn.className = `page-item ${i === this.currentPage ? 'active' : ''}`;
                pageBtn.innerHTML = `<a class="page-link" href="#" onclick="inventoryManager.changePage(${i})">${i}</a>`;
                paginationContainer.appendChild(pageBtn);
            } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                const ellipsis = document.createElement('li');
                ellipsis.className = 'page-item disabled';
                ellipsis.innerHTML = '<span class="page-link">...</span>';
                paginationContainer.appendChild(ellipsis);
            }
        }

        // Next button
        const nextBtn = document.createElement('li');
        nextBtn.className = `page-item ${this.currentPage === totalPages ? 'disabled' : ''}`;
        nextBtn.innerHTML = `<a class="page-link" href="#" onclick="inventoryManager.changePage(${this.currentPage + 1})">Next</a>`;
        paginationContainer.appendChild(nextBtn);
    }

    updatePaginationInfo() {
        const startIndex = (this.currentPage - 1) * this.pageSize + 1;
        const endIndex = Math.min(this.currentPage * this.pageSize, this.totalItems);

        document.getElementById('showingEntries').textContent = `${startIndex}-${endIndex}`;
        document.getElementById('totalEntries').textContent = this.totalItems;
    }

    changePage(page) {
        const totalPages = Math.ceil(this.totalItems / this.pageSize);
        if (page >= 1 && page <= totalPages) {
            this.currentPage = page;
            this.renderTable();
            this.updatePagination();
        }
    }

    performSearch() {
        const searchTerm = document.getElementById('searchInventoryInput').value.toLowerCase().trim();

        if (searchTerm === '') {
            this.filteredData = [...this.inventoryData];
        } else {
            this.filteredData = this.inventoryData.filter(item =>
                item.inventoryCode.toLowerCase().includes(searchTerm) ||
                item.name.toLowerCase().includes(searchTerm) ||
                item.description?.toLowerCase().includes(searchTerm) ||
                item.category?.toLowerCase().includes(searchTerm) ||
                item.location?.toLowerCase().includes(searchTerm)
            );
        }

        this.currentPage = 1;
        this.renderTable();
        this.updatePagination();
    }

    applyFilters() {
        const typeFilter = document.getElementById('typeFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;

        this.filteredData = this.inventoryData.filter(item => {
            const typeMatch = !typeFilter || item.itemType === typeFilter;
            const statusMatch = !statusFilter || item.status === statusFilter;
            return typeMatch && statusMatch;
        });

        this.currentPage = 1;
        this.renderTable();
        this.updatePagination();
    }

    showLowStock() {
        this.filteredData = this.inventoryData.filter(item =>
            item.minimumThreshold && item.totalQuantity <= item.minimumThreshold
        );
        this.currentPage = 1;
        this.renderTable();
        this.updatePagination();
        this.showToast('Filter Applied', 'Showing low stock items only', 'info');
    }

    showOverStock() {
        this.filteredData = this.inventoryData.filter(item =>
            item.maximumThreshold && item.totalQuantity >= item.maximumThreshold
        );
        this.currentPage = 1;
        this.renderTable();
        this.updatePagination();
        this.showToast('Filter Applied', 'Showing overstock items only', 'info');
    }

    showInventoryModal(inventory = null) {
        const modal = new bootstrap.Modal(document.getElementById('inventoryModal'));
        const form = document.getElementById('inventoryForm');

        // Reset form
        form.reset();

        if (inventory) {
            // Edit mode
            document.getElementById('inventoryModalLabel').textContent = 'Edit Inventory Item';
            document.getElementById('inventoryId').value = inventory.inventoryId;
            document.getElementById('inventoryCode').value = inventory.inventoryCode;
            document.getElementById('name').value = inventory.name;
            document.getElementById('description').value = inventory.description || '';
            document.getElementById('itemType').value = inventory.itemType;
            document.getElementById('status').value = inventory.status;
            document.getElementById('location').value = inventory.location || '';
            document.getElementById('category').value = inventory.category || '';
            document.getElementById('totalQuantity').value = inventory.totalQuantity;
            document.getElementById('minimumThreshold').value = inventory.minimumThreshold || '';
            document.getElementById('maximumThreshold').value = inventory.maximumThreshold || '';
            document.getElementById('unitCost').value = inventory.unitCost || '';
            document.getElementById('totalValue').value = inventory.totalValue || '';
        } else {
            // Add mode
            document.getElementById('inventoryModalLabel').textContent = 'Add New Inventory Item';
            document.getElementById('inventoryId').value = '';
        }

        modal.show();
    }

    async saveInventory() {
        const form = document.getElementById('inventoryForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const formData = new FormData(form);
        const inventoryData = {
            inventoryCode: document.getElementById('inventoryCode').value,
            name: document.getElementById('name').value,
            description: document.getElementById('description').value,
            itemType: document.getElementById('itemType').value,
            status: document.getElementById('status').value,
            location: document.getElementById('location').value,
            category: document.getElementById('category').value,
            totalQuantity: parseInt(document.getElementById('totalQuantity').value),
            availableQuantity: parseInt(document.getElementById('totalQuantity').value),
            reservedQuantity: 0,
            minimumThreshold: parseInt(document.getElementById('minimumThreshold').value) || null,
            maximumThreshold: parseInt(document.getElementById('maximumThreshold').value) || null,
            unitCost: parseFloat(document.getElementById('unitCost').value) || null,
            totalValue: parseFloat(document.getElementById('totalValue').value) || null
        };

        const inventoryId = document.getElementById('inventoryId').value;
        const isEdit = inventoryId !== '';

        try {
            const response = await fetch(
                isEdit ? `${this.baseUrl}/${inventoryId}` : this.baseUrl,
                {
                    method: isEdit ? 'PUT' : 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(inventoryData)
                }
            );

            if (response.ok) {
                const modal = bootstrap.Modal.getInstance(document.getElementById('inventoryModal'));
                modal.hide();

                this.showToast('Success', `Inventory ${isEdit ? 'updated' : 'created'} successfully`, 'success');
                this.loadInventoryData();
                this.loadStats();
            } else {
                const errorText = await response.text();
                this.showToast('Error', `Failed to save inventory: ${errorText}`, 'error');
            }
        } catch (error) {
            console.error('Error saving inventory:', error);
            this.showToast('Error', 'Failed to connect to server', 'error');
        }
    }

    async editInventory(id) {
        try {
            const response = await fetch(`${this.baseUrl}/${id}`);
            if (response.ok) {
                const inventory = await response.json();
                this.showInventoryModal(inventory);
            } else {
                this.showToast('Error', 'Failed to load inventory data', 'error');
            }
        } catch (error) {
            console.error('Error loading inventory:', error);
            this.showToast('Error', 'Failed to connect to server', 'error');
        }
    }

    deleteInventory(id) {
        const item = this.inventoryData.find(inv => inv.inventoryId === id);
        if (item) {
            document.getElementById('deleteItemName').textContent = item.name;
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            modal.show();

            // Store the ID for confirmation
            document.getElementById('deleteConfirmModal').dataset.itemId = id;
        }
    }

    async confirmDelete() {
        const id = document.getElementById('deleteConfirmModal').dataset.itemId;

        try {
            const response = await fetch(`${this.baseUrl}/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                modal.hide();

                this.showToast('Success', 'Inventory item deleted successfully', 'success');
                this.loadInventoryData();
                this.loadStats();
            } else {
                this.showToast('Error', 'Failed to delete inventory item', 'error');
            }
        } catch (error) {
            console.error('Error deleting inventory:', error);
            this.showToast('Error', 'Failed to connect to server', 'error');
        }
    }

    showStockOperation(id, operation) {
        const item = this.inventoryData.find(inv => inv.inventoryId === id);
        if (!item) return;

        const modal = new bootstrap.Modal(document.getElementById('stockOperationModal'));
        const form = document.getElementById('stockOperationForm');

        // Reset form
        form.reset();

        // Set item information
        document.getElementById('stockInventoryId').value = id;
        document.getElementById('stockOperation').value = operation;
        document.getElementById('stockItemName').textContent = item.name;
        document.getElementById('stockItemCode').textContent = item.inventoryCode;
        document.getElementById('stockAvailable').textContent = item.availableQuantity;
        document.getElementById('stockReserved').textContent = item.reservedQuantity;

        // Set modal title
        const operationTitles = {
            'add': 'Add Stock',
            'remove': 'Remove Stock',
            'reserve': 'Reserve Stock'
        };
        document.getElementById('stockOperationModalLabel').textContent = operationTitles[operation];

        modal.show();
    }

    async executeStockOperation() {
        const form = document.getElementById('stockOperationForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const id = document.getElementById('stockInventoryId').value;
        const operation = document.getElementById('stockOperation').value;
        const quantity = parseInt(document.getElementById('stockQuantity').value);
        const reason = document.getElementById('stockReason').value;
        const performedBy = document.getElementById('stockPerformedBy').value;

        const endpoints = {
            'add': 'add-stock',
            'remove': 'remove-stock',
            'reserve': 'reserve-stock'
        };

        try {
            const response = await fetch(`${this.baseUrl}/${id}/${endpoints[operation]}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    quantity: quantity,
                    reason: reason,
                    performedBy: performedBy
                })
            });

            if (response.ok) {
                const modal = bootstrap.Modal.getInstance(document.getElementById('stockOperationModal'));
                modal.hide();

                this.showToast('Success', `Stock ${operation} operation completed successfully`, 'success');
                this.loadInventoryData();
                this.loadStats();
            } else {
                const errorText = await response.text();
                this.showToast('Error', `Failed to execute stock operation: ${errorText}`, 'error');
            }
        } catch (error) {
            console.error('Error executing stock operation:', error);
            this.showToast('Error', 'Failed to connect to server', 'error');
        }
    }

    async viewDetails(id) {
        try {
            const response = await fetch(`${this.baseUrl}/${id}`);
            if (response.ok) {
                const item = await response.json();
                this.showDetailsModal(item);
            } else {
                this.showToast('Error', 'Failed to load inventory details', 'error');
            }
        } catch (error) {
            console.error('Error loading inventory details:', error);
            this.showToast('Error', 'Failed to connect to server', 'error');
        }
    }

    showDetailsModal(item) {
        const modal = new bootstrap.Modal(document.getElementById('inventoryDetailsModal'));

        // Set item ID for reference
        document.getElementById('inventoryDetailsModal').dataset.itemId = item.inventoryId;

        // Populate details
        document.getElementById('detailsCode').textContent = item.inventoryCode;
        document.getElementById('detailsName').textContent = item.name;
        document.getElementById('detailsDescription').textContent = item.description || '-';
        document.getElementById('detailsType').textContent = item.itemType.replace('_', ' ');
        document.getElementById('detailsStatus').textContent = item.status.replace('_', ' ');
        document.getElementById('detailsLocation').textContent = item.location || '-';
        document.getElementById('detailsCategory').textContent = item.category || '-';
        document.getElementById('detailsTotalQuantity').textContent = item.totalQuantity;
        document.getElementById('detailsAvailableQuantity').textContent = item.availableQuantity;
        document.getElementById('detailsReservedQuantity').textContent = item.reservedQuantity;
        document.getElementById('detailsMinThreshold').textContent = item.minimumThreshold || '-';
        document.getElementById('detailsMaxThreshold').textContent = item.maximumThreshold || '-';
        document.getElementById('detailsUnitCost').textContent = item.unitCost ? `$${item.unitCost.toFixed(2)}` : '-';
        document.getElementById('detailsTotalValue').textContent = item.totalValue ? `$${item.totalValue.toFixed(2)}` : '-';

        // Set stock progress
        const stockProgress = document.getElementById('detailsStockProgress');
        if (item.maximumThreshold) {
            const percentage = (item.totalQuantity / item.maximumThreshold) * 100;
            stockProgress.style.width = `${Math.min(percentage, 100)}%`;

            if (item.minimumThreshold && item.totalQuantity <= item.minimumThreshold) {
                stockProgress.className = 'progress-bar bg-danger';
            } else if (percentage >= 80) {
                stockProgress.className = 'progress-bar bg-warning';
            } else {
                stockProgress.className = 'progress-bar bg-success';
            }
        } else {
            stockProgress.style.width = '0%';
            stockProgress.className = 'progress-bar bg-secondary';
        }

        // Set dates
        document.getElementById('detailsCreatedDate').textContent = new Date(item.createdDate).toLocaleDateString();
        document.getElementById('detailsLastUpdated').textContent = new Date(item.lastUpdated).toLocaleDateString();

        modal.show();
    }

    async viewTransactions(id) {
        try {
            const response = await fetch(`${this.baseUrl}/${id}`);
            if (response.ok) {
                const item = await response.json();
                this.showTransactionsModal(item.transactions || []);
            } else {
                this.showToast('Error', 'Failed to load transaction history', 'error');
            }
        } catch (error) {
            console.error('Error loading transactions:', error);
            this.showToast('Error', 'Failed to connect to server', 'error');
        }
    }

    showTransactionsModal(transactions) {
        const modal = new bootstrap.Modal(document.getElementById('transactionsModal'));
        const tbody = document.getElementById('transactionsTableBody');

        tbody.innerHTML = '';

        if (transactions.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center">No transactions found</td></tr>';
        } else {
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(transaction.transactionDate).toLocaleDateString()}</td>
                    <td><span class="badge ${this.getTransactionBadgeClass(transaction.transactionType)}">${transaction.transactionType.replace('_', ' ')}</span></td>
                    <td>${transaction.quantity}</td>
                    <td>${transaction.reason}</td>
                    <td>${transaction.performedBy}</td>
                `;
                tbody.appendChild(row);
            });
        }

        modal.show();
    }

    getTransactionBadgeClass(type) {
        const typeClasses = {
            'STOCK_IN': 'bg-success',
            'STOCK_OUT': 'bg-danger',
            'RESERVED': 'bg-warning',
            'RELEASED': 'bg-info',
            'ADJUSTMENT': 'bg-secondary'
        };
        return typeClasses[type] || 'bg-secondary';
    }

    exportToCSV() {
        const headers = [
            'Code', 'Name', 'Type', 'Category', 'Location', 'Total Qty',
            'Available', 'Reserved', 'Status', 'Unit Cost', 'Total Value'
        ];

        const csvContent = [
            headers.join(','),
            ...this.filteredData.map(item => [
                item.inventoryCode,
                `"${item.name}"`,
                item.itemType.replace('_', ' '),
                `"${item.category || ''}"`,
                `"${item.location || ''}"`,
                item.totalQuantity,
                item.availableQuantity,
                item.reservedQuantity,
                item.status.replace('_', ' '),
                item.unitCost || '',
                item.totalValue || ''
            ].join(','))
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `inventory_export_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        this.showToast('Success', 'Inventory data exported successfully', 'success');
    }

    showToast(title, message, type = 'info') {
        const toast = document.getElementById('notificationToast');
        const toastTitle = document.getElementById('toastTitle');
        const toastMessage = document.getElementById('toastMessage');

        toastTitle.textContent = title;
        toastMessage.textContent = message;

        // Set icon based on type
        const icon = toast.querySelector('.toast-header i');
        const iconClasses = {
            'success': 'bi-check-circle text-success',
            'error': 'bi-exclamation-triangle text-danger',
            'warning': 'bi-exclamation-triangle text-warning',
            'info': 'bi-info-circle text-info'
        };

        icon.className = `bi ${iconClasses[type] || iconClasses.info} me-2`;

        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
    }
}

// Initialize the inventory manager when the page loads
let inventoryManager;
document.addEventListener('DOMContentLoaded', function() {
    inventoryManager = new InventoryManager();
});

</script>
<script src="js/singleWindowValidator.js"></script>
</body>
</html>