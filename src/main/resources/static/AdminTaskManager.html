<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMAS - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-blue: #1E40AF;
            --secondary-red: #DC2626;
            --light-blue: #3B82F6;
            --light-red: #EF4444;
            --gold: #F59E0B;
            --green: #10B981;
            --gray-dark: #1F2937;
            --gray-medium: #6B7280;
            --gray-light: #F3F4F6;
            --white: #FFFFFF;
            --sidebar-width: 260px;
            --header-height: 70px;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --white: #1F2937;
            --gray-light: #374151;
            --gray-medium: #9CA3AF;
            --gray-dark: #F9FAFB;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-light);
            color: var(--gray-dark);
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            height: var(--header-height);
            background: var(--white);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 2rem;
            transition: var(--transition);
        }

        .header.expanded {
            left: 80px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background: var(--gray-light);
        }

        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-dark);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .notification-btn:hover {
            background: var(--gray-light);
        }

        .notification-badge {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: var(--secondary-red);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: var(--gray-light);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--gray-light);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-profile:hover {
            background: var(--light-blue);
            color: var(--white);
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-red));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--white);
            border-right: 1px solid rgba(0,0,0,0.1);
            box-shadow: var(--shadow);
            z-index: 1100;
            transition: var(--transition);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-red));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-blue);
            transition: var(--transition);
        }

        .sidebar.collapsed .logo-text {
            opacity: 0;
            transform: translateX(-10px);
        }

        .sidebar-menu {
            flex: 1;
            padding: 1rem 0;
        }

        .sidebar-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu li {
            margin: 0.25rem 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.5rem;
            color: var(--gray-medium);
            text-decoration: none;
            transition: var(--transition);
            border-radius: 0 25px 25px 0;
            margin-right: 1rem;
            font-weight: 500;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: linear-gradient(90deg, rgba(30,64,175,0.1) 0%, rgba(30,64,175,0.05) 100%);
            color: var(--primary-blue);
            transform: translateX(5px);
        }

        .sidebar-menu a.active {
            border-right: 3px solid var(--primary-blue);
        }

        .sidebar-menu i {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .sidebar-menu .menu-text {
            transition: var(--transition);
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            transform: translateX(-10px);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 2rem;
            min-height: calc(100vh - var(--header-height));
            transition: var(--transition);
        }

        .main-content.expanded {
            margin-left: 80px;
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--white);
            flex-shrink: 0;
        }

        .stat-icon.equipment {
            background: linear-gradient(135deg, var(--green), #22C55E);
        }

        .stat-icon.tasks {
            background: linear-gradient(135deg, var(--secondary-red), var(--light-red));
        }

        .stat-icon.technicians {
            background: linear-gradient(135deg, var(--primary-blue), var(--light-blue));
        }

        .stat-icon.inventory {
            background: linear-gradient(135deg, var(--gold), #F59E0B);
        }

        .stat-info h3 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--gray-dark);
            margin-bottom: 0.5rem;
        }

        .stat-info p {
            color: var(--gray-medium);
            font-weight: 500;
        }

        /* Tables */
        .table-container {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 0;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gray-light);
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-dark);
        }

        .table-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table th {
            background: var(--gray-light);
            font-weight: 600;
            color: var(--gray-dark);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tr:hover {
            background: rgba(30, 64, 175, 0.05);
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green);
        }

        .status-badge.inactive {
            background: rgba(107, 114, 128, 0.1);
            color: var(--gray-medium);
        }

        .status-badge.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--gold);
        }

        .status-badge.completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green);
        }

        .status-badge.in-progress {
            background: rgba(59, 130, 246, 0.1);
            color: var(--light-blue);
        }

        .status-badge.assigned {
            background: rgba(139, 92, 246, 0.1);
            color: #8B5CF6;
        }

        /* Buttons */
        .btn {
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: var(--light-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30,64,175,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-success {
            background: var(--green);
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--gold);
            color: var(--gray-dark);
        }

        .btn-warning:hover {
            background: #F59E0B;
        }

        .btn-danger {
            background: var(--secondary-red);
        }

        .btn-danger:hover {
            background: var(--light-red);
        }

        .btn-secondary {
            background: var(--gray-medium);
        }

        .btn-secondary:hover {
            background: var(--gray-dark);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-dark);
        }

        .form-control {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--gray-dark);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(30,64,175,0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-medium);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: var(--gray-light);
            color: var(--gray-dark);
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s linear infinite;
        }

        /* Search and Filters */
        .search-filters {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }

        /* Notifications */
        .notification-item {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-blue);
            transition: var(--transition);
            cursor: pointer;
        }

        .notification-item.unread {
            background: rgba(30, 64, 175, 0.05);
        }

        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .notification-title {
            font-weight: 600;
            color: var(--gray-dark);
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--gray-medium);
        }

        .notification-message {
            color: var(--gray-medium);
            line-height: 1.4;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Logout item */
        .logout-item {
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 10px;
        }

        .logout-item a {
            color: #ff6b6b !important;
        }

        .logout-item a:hover {
            background-color: rgba(255, 107, 107, 0.1) !important;
            color: #ff5252 !important;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }

            .sidebar .menu-text,
            .sidebar .logo-text {
                opacity: 0;
                transform: translateX(-10px);
            }

            .main-content {
                margin-left: 80px;
            }

            .header {
                left: 80px;
            }

            .filter-row {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .header {
                left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Priority badges */
        .priority-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-badge.high {
            background: rgba(220, 38, 38, 0.1);
            color: var(--secondary-red);
        }

        .priority-badge.medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--gold);
        }

        .priority-badge.low {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green);
        }

        /* Action buttons in tables */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .action-btn {
            padding: 0.375rem 0.75rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .action-btn.edit {
            background: rgba(59, 130, 246, 0.1);
            color: var(--light-blue);
        }

        .action-btn.edit:hover {
            background: var(--light-blue);
            color: white;
        }

        .action-btn.delete {
            background: rgba(220, 38, 38, 0.1);
            color: var(--secondary-red);
        }

        .action-btn.delete:hover {
            background: var(--secondary-red);
            color: white;
        }

        .action-btn.view {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green);
        }

        .action-btn.view:hover {
            background: var(--green);
            color: white;
        }

        /* Report specific styles */
        .report-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            transition: var(--transition);
            cursor: pointer;
            border-left: 4px solid var(--primary-blue);
        }

        .report-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .report-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-dark);
        }

        .report-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
            background: var(--primary-blue);
        }

        .report-description {
            color: var(--gray-medium);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .report-actions {
            display: flex;
            gap: 0.5rem;
        }




        .equipment-details {
    padding: 1.5rem;
}

.detail-row {
    display: flex;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--gray-light);
}

.detail-row.full-width {
    flex-direction: column;
}

.detail-label {
    font-weight: 600;
    color: var(--gray-dark);
    min-width: 150px;
}

.detail-value {
    color: var(--gray-medium);
    flex: 1;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    padding: 1.5rem;
    border-top: 1px solid var(--gray-light);
    margin-top: 1rem;
}
    </style>
</head>

<body data-theme="light">
<!-- Sidebar -->
<nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="logo-icon">
            <i class="fas fa-cogs"></i>
        </div>
        <span class="logo-text">IMAS Admin</span>
    </div>
    <div class="sidebar-menu">
        <ul>
            <li>
                <a href="#" class="active" onclick="showSection('dashboard', event)">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">Dashboard</span>
                </a>
            </li>

            <!-- Equipment Management -->
            <li>
                <a href="#" onclick="showSection('equipment', event)">
                    <i class="fas fa-tools"></i>
                    <span class="menu-text">Equipment</span>
                </a>
            </li>

            <!-- Task Management -->
            <li>
                <a href="#" onclick="showSection('tasks', event)">
                    <i class="fas fa-tasks"></i>
                    <span class="menu-text">Maintenance Tasks</span>
                </a>
            </li>


            <li>
                <a href="ScheduleManagement.html" target="_blank">
                    <i class="fas fa-tasks"></i>
                    <span class="menu-text">Schedule</span>
                </a>
            </li>
            <li>
                <a href="CrudStaff.html" target="_blank">
                    <i class="fas fa-users"></i>
                    <span class="menu-text">Staff Management</span>
                </a>
            </li>
            <li>
                <a href="Dashboard.html" target="_blank">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">Management</span>
                </a>
            </li>

            <!-- Staff Management -->
            <li>
                <a href="#" onclick="showSection('staff', event)">
                    <i class="fas fa-users"></i>
                    <span class="menu-text">Staff</span>
                </a>
            </li>

            <!-- Spare Parts -->
            <li>
                <a href="#" onclick="showSection('spare-parts', event)">
                    <i class="fas fa-cog"></i>
                    <span class="menu-text">Spare Parts</span>
                </a>
            </li>

            <!-- Inventory -->
            <li>
                <a href="#" onclick="showSection('inventory', event)">
                    <i class="fas fa-boxes"></i>
                    <span class="menu-text">Inventory</span>
                </a>
            </li>

            <!-- Task Assignment -->
            <li>
                <a href="#" onclick="showSection('task-assignment', event)">
                    <i class="fas fa-user-plus"></i>
                    <span class="menu-text">Task Assignment</span>
                </a>
            </li>

            <!-- Technician Stats -->
            <li>
                <a href="#" onclick="showSection('technician-stats', event)">
                    <i class="fas fa-chart-line"></i>
                    <span class="menu-text">Technician Stats</span>
                </a>
            </li>

            <!-- Reports -->
            <li>
                <a href="#" onclick="showSection('reports', event)">
                    <i class="fas fa-file-alt"></i>
                    <span class="menu-text">Reports</span>
                </a>
            </li>

            <!-- Analytics -->
            <li>
                <a href="#" onclick="showSection('analytics', event)">
                    <i class="fas fa-chart-bar"></i>
                    <span class="menu-text">Analytics</span>
                </a>
            </li>

            <!-- Notifications -->
            <li>
                <a href="#" onclick="showSection('notifications', event)">
                    <i class="fas fa-bell"></i>
                    <span class="menu-text">Notifications</span>
                </a>
            </li>

            <!-- Export Data -->
            <li>
                <a href="#" onclick="showSection('export', event)">
                    <i class="fas fa-download"></i>
                    <span class="menu-text">Export Data</span>
                </a>
            </li>

            <!-- Logout -->
            <li class="logout-item">
                <a href="#" onclick="handleLogout(event)">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="menu-text">Logout</span>
                </a>
            </li>
        </ul>
    </div>
</nav>

<!-- Header -->
<header class="header" id="header">
    <div class="header-left">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>
    <div class="header-center">
        <h1 class="header-title">Admin Dashboard</h1>
    </div>
    <div class="header-right">
        <button class="notification-btn" onclick="showSection('notifications')">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationCount">0</span>
        </button>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
        <div class="user-profile" id="userProfile">
            <div class="user-avatar" id="userAvatar">A</div>
            <span id="userName">Admin</span>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="main-content" id="mainContent">

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--gray-dark);" id="welcomeMessage">Welcome to Admin Dashboard</h1>
            <button class="btn" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt"></i>
                Refresh Data
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card" onclick="showSection('equipment')">
                <div class="stat-icon equipment">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalEquipment">0</h3>
                    <p>Total Equipment</p>
                </div>
            </div>
            <div class="stat-card" onclick="showSection('tasks')">
                <div class="stat-icon tasks">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalTasks">0</h3>
                    <p>Maintenance Tasks</p>
                </div>
            </div>
            <div class="stat-card" onclick="showSection('staff')">
                <div class="stat-icon technicians">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalTechnicians">0</h3>
                    <p>Technicians</p>
                </div>
            </div>
            <div class="stat-card" onclick="showSection('inventory')">
                <div class="stat-icon inventory">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalInventory">0</h3>
                    <p>Inventory Items</p>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Equipment Status Overview</h3>
                <div class="chart-container">
                    <canvas id="equipmentStatusChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Task Priority Distribution</h3>
                <div class="chart-container">
                    <canvas id="taskPriorityChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Monthly Equipment Maintenance</h3>
                <div class="chart-container">
                    <canvas id="monthlyMaintenanceChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Technician Workload</h3>
                <div class="chart-container">
                    <canvas id="technicianWorkloadChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 1.5rem;">Recent Activities</h3>
            <div id="recentActivities">
                <p style="color: var(--gray-medium);">Loading recent activities...</p>
            </div>
        </div>
    </section>

    <!-- Equipment Section -->
    <section id="equipment-section" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--gray-dark);">Equipment Management</h1>
            <button class="btn" onclick="openModal('equipmentModal')">
                <i class="fas fa-plus"></i>
                Add Equipment
            </button>
        </div>

        <div class="search-filters">
            <div class="filter-row">
                <div class="form-group">
                    <input type="text" class="form-control" id="equipmentSearch" placeholder="Search equipment..." onkeyup="searchEquipment()">
                </div>
                <div class="form-group">
                    <select class="form-control" id="equipmentStatusFilter" onchange="filterEquipment()">
                        <option value="">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                        <option value="MAINTENANCE">Maintenance</option>
                        <option value="OUT_OF_ORDER">Out of Order</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-control" id="equipmentLocationFilter" onchange="filterEquipment()">
                        <option value="">All Locations</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="exportEquipmentData()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Equipment List</h3>
                <div class="table-actions">
                    <button class="btn btn-sm" onclick="refreshEquipmentData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="equipmentTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Model</th>
                        <th>Serial Number</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Last Maintenance</th>
                        <th>Next Maintenance</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="equipmentTableBody">
                    <tr>
                        <td colspan="9" style="text-align: center; color: var(--gray-medium);">Loading equipment data...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Tasks Section -->
    <section id="tasks-section" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--gray-dark);">Maintenance Tasks</h1>
            <button class="btn" onclick="openModal('taskModal')">
                <i class="fas fa-plus"></i>
                Create Task
            </button>
        </div>

        <div class="search-filters">
            <div class="filter-row">
                <div class="form-group">
                    <input type="text" class="form-control" id="taskSearch" placeholder="Search tasks..." onkeyup="searchTasks()">
                </div>
                <div class="form-group">
                    <select class="form-control" id="taskStatusFilter" onchange="filterTasks()">
                        <option value="">All Status</option>
                        <option value="PLANNED">Planned</option>
                        <option value="ASSIGNED">Assigned</option>
                        <option value="IN_PROGRESS">In Progress</option>
                        <option value="COMPLETED">Completed</option>
                        <option value="ON_HOLD">On Hold</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-control" id="taskPriorityFilter" onchange="filterTasks()">
                        <option value="">All Priorities</option>
                        <option value="HIGH">High</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="LOW">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="exportTasksData()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Tasks List</h3>
                <div class="table-actions">
                    <button class="btn btn-sm" onclick="refreshTasksData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="tasksTable">
                    <thead>
                    <tr>
                        <th>Task ID</th>
                        <th>Description</th>
                        <th>Equipment</th>
                        <th>Assigned To</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Due Date</th>
                        <th>Progress</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="tasksTableBody">
                    <tr>
                        <td colspan="10" style="text-align: center; color: var(--gray-medium);">Loading tasks data...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Staff Section -->
    <section id="staff-section" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--gray-dark);">Staff Management</h1>
            <button class="btn" onclick="openModal('staffModal')">
                <i class="fas fa-plus"></i>
                Add Staff
            </button>
        </div>

        <div class="search-filters">
            <div class="filter-row">
                <div class="form-group">
                    <input type="text" class="form-control" id="staffSearch" placeholder="Search staff..." onkeyup="searchStaff()">
                </div>
                <div class="form-group">
                    <select class="form-control" id="staffRoleFilter" onchange="filterStaff()">
                        <option value="">All Roles</option>
                        <option value="TECHNICIAN">Technician</option>
                        <option value="ADMIN">Admin</option>
                        <option value="SUPERVISOR">Supervisor</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-control" id="staffStatusFilter" onchange="filterStaff()">
                        <option value="">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="exportStaffData()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Staff List</h3>
                <div class="table-actions">
                    <button class="btn btn-sm" onclick="refreshStaffData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="staffTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Role</th>
                        <th>Skills</th>
                        <th>Active Tasks</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="staffTableBody">
                    <tr>
                        <td colspan="9" style="text-align: center; color: var(--gray-medium);">Loading staff data...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Spare Parts Section -->
    <section id="spare-parts-section" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--gray-dark);">Spare Parts Management</h1>
            <button class="btn" onclick="openModal('sparePartModal')">
                <i class="fas fa-plus"></i>
                Add Spare Part
            </button>
        </div>

        <div class="search-filters">
            <div class="filter-row">
                <div class="form-group">
                    <input type="text" class="form-control" id="sparePartSearch" placeholder="Search spare parts..." onkeyup="searchSpareParts()">
                </div>
                <div class="form-group">
                    <select class="form-control" id="sparePartCategoryFilter" onchange="filterSpareParts()">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-control" id="sparePartStockFilter" onchange="filterSpareParts()">
                        <option value="">All Stock Levels</option>
                        <option value="low">Low Stock</option>
                        <option value="out">Out of Stock</option>
                        <option value="adequate">Adequate</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="exportSparePartsData()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Spare Parts Inventory</h3>
                <div class="table-actions">
                    <button class="btn btn-sm" onclick="refreshSparePartsData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="sparePartsTable">
                    <thead>
                    <tr>
                        <th>Part Number</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Supplier</th>
                        <th>Stock Quantity</th>
                        <th>Min Stock</th>
                        <th>Unit Price</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="sparePartsTableBody">
                    <tr>
                        <td colspan="10" style="text-align: center; color: var(--gray-medium);">Loading spare parts data...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Inventory Section -->
    <section id="inventory-section" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--gray-dark);">Inventory Management</h1>
            <button class="btn" onclick="openModal('inventoryModal')">
                <i class="fas fa-plus"></i>
                Add Inventory Item
            </button>
        </div>

        <div class="search-filters">
            <div class="filter-row">
                <div class="form-group">
                    <input type="text" class="form-control" id="inventorySearch" placeholder="Search inventory..." onkeyup="searchInventory()">
                </div>
                <div class="form-group">
                    <select class="form-control" id="inventoryTypeFilter" onchange="filterInventory()">
                        <option value="">All Types</option>
                        <option value="SPARE_PART">Spare Part</option>
                        <option value="TOOL">Tool</option>
                        <option value="CONSUMABLE">Consumable</option>
                        <option value="RAW_MATERIAL">Raw Material</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-control" id="inventoryStockFilter" onchange="filterInventory()">
                        <option value="">All Stock Levels</option>
                        <option value="low">Low Stock</option>
                        <option value="overstock">Overstock</option>
                        <option value="normal">Normal</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="exportInventoryData()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Inventory Items</h3>
                <div class="table-actions">
                    <button class="btn btn-sm" onclick="refreshInventoryData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="inventoryTable">
                    <thead>
                    <tr>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Total Qty</th>
                        <th>Available</th>
                        <th>Reserved</th>
                        <th>Min Threshold</th>
                        <th>Max Threshold</th>
                        <th>Unit Cost</th>
                        <th>Total Value</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Last Updated</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                    <tr>
                        <td colspan="10" style="text-align: center; color: var(--gray-medium);">Loading inventory data...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Task Assignment Section -->
    <section id="task-assignment-section" class="section hidden">
        <h1 style="margin-bottom: 2rem; color: var(--gray-dark);">Task Assignment</h1>

        <div class="form-grid">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Quick Task Assignment</h3>
                <form id="quickAssignForm">
                    <div class="form-group">
                        <label>Select Task</label>
                        <select class="form-control" id="assignTaskSelect" required>
                            <option value="">Select a task to assign...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Select Technician</label>
                        <select class="form-control" id="assignTechnicianSelect" required>
                            <option value="">Select a technician...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="datetime-local" class="form-control" id="assignDueDate">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea class="form-control" id="assignNotes" rows="3" placeholder="Additional instructions..."></textarea>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-user-plus"></i>
                        Assign Task
                    </button>
                </form>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Technician Availability</h3>
                <div id="technicianAvailability">
                    <p style="color: var(--gray-medium);">Loading technician availability...</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 1.5rem;">Recent Assignments</h3>
            <div id="recentAssignments">
                <p style="color: var(--gray-medium);">Loading recent assignments...</p>
            </div>
        </div>
    </section>

    <!-- Technician Stats Section -->
    <section id="technician-stats-section" class="section hidden">
        <h1 style="margin-bottom: 2rem; color: var(--gray-dark);">Technician Statistics</h1>

        <div class="search-filters">
            <div class="filter-row">
                <div class="form-group">
                    <select class="form-control" id="technicianStatsSelect" onchange="loadTechnicianStats()">
                        <option value="">All Technicians</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-control" id="statsTimeRange" onchange="loadTechnicianStats()">
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn" onclick="loadTechnicianStats()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Stats
                    </button>
                </div>
            </div>
        </div>

        <div class="stats-grid" id="technicianStatsGrid">
            <!-- Stats will be populated here -->
        </div>

        <div class="charts-grid">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Task Completion Rate</h3>
                <div class="chart-container">
                    <canvas id="technicianCompletionChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Performance Comparison</h3>
                <div class="chart-container">
                    <canvas id="technicianPerformanceChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Task Distribution</h3>
                <div class="chart-container">
                    <canvas id="taskDistributionChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Average Task Duration</h3>
                <div class="chart-container">
                    <canvas id="taskDurationChart"></canvas>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Detailed Technician Performance</h3>
                <div class="table-actions">
                    <button class="btn btn-sm" onclick="exportTechnicianStats()">
                        <i class="fas fa-download"></i>
                        Export Stats
                    </button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="technicianStatsTable">
                    <thead>
                    <tr>
                        <th>Technician</th>
                        <th>Total Tasks</th>
                        <th>Completed</th>
                        <th>In Progress</th>
                        <th>Overdue</th>
                        <th>Completion Rate</th>
                        <th>Avg Duration</th>
                        <th>Rating</th>
                    </tr>
                    </thead>
                    <tbody id="technicianStatsTableBody">
                    <tr>
                        <td colspan="8" style="text-align: center; color: var(--gray-medium);">Loading technician statistics...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Reports Section -->
    <section id="reports-section" class="section hidden">
        <h1 style="margin-bottom: 2rem; color: var(--gray-dark);">Reports & Analytics</h1>

        <div class="form-grid">
            <div class="report-card" onclick="generateReport('monthly')">
                <div class="report-header">
                    <div class="report-title">Monthly Report</div>
                    <div class="report-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                </div>
                <div class="report-description">
                    Comprehensive monthly maintenance report including equipment status, task completion, and technician performance.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('monthly')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('monthly')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('weekly')">
                <div class="report-header">
                    <div class="report-title">Weekly Report</div>
                    <div class="report-icon">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                </div>
                <div class="report-description">
                    Weekly summary of maintenance activities, task assignments, and equipment performance metrics.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('weekly')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('weekly')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('annual')">
                <div class="report-header">
                    <div class="report-title">Annual Report</div>
                    <div class="report-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                </div>
                <div class="report-description">
                    Yearly analysis of maintenance trends, equipment lifecycle, cost analysis, and performance insights.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('annual')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('annual')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('technician')">
                <div class="report-header">
                    <div class="report-title">Technician Performance Report</div>
                    <div class="report-icon">
                        <i class="fas fa-user-cog"></i>
                    </div>
                </div>
                <div class="report-description">
                    Individual technician performance analysis including task completion rates, efficiency metrics, and skill assessment.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('technician')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('technician')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('equipment')">
                <div class="report-header">
                    <div class="report-title">Equipment Analysis Report</div>
                    <div class="report-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                </div>
                <div class="report-description">
                    Detailed equipment analysis including maintenance history, reliability metrics, and cost of ownership.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('equipment')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('equipment')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('inventory')">
                <div class="report-header">
                    <div class="report-title">Inventory Report</div>
                    <div class="report-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                </div>
                <div class="report-description">
                    Inventory analysis including stock levels, usage patterns, procurement recommendations, and cost analysis.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('inventory')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('inventory')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('cost')">
                <div class="report-header">
                    <div class="report-title">Cost Analysis Report</div>
                    <div class="report-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                </div>
                <div class="report-description">
                    Comprehensive cost analysis including maintenance expenses, parts costs, labor costs, and budget vs actual.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('cost')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('cost')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>

            <div class="report-card" onclick="generateReport('compliance')">
                <div class="report-header">
                    <div class="report-title">Compliance Report</div>
                    <div class="report-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                </div>
                <div class="report-description">
                    Compliance and audit report including safety standards adherence, regulatory compliance, and certification status.
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); generateReport('compliance')">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); generateExcelReport('compliance')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 1.5rem;">Custom Report Generator</h3>
            <form id="customReportForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select class="form-control" id="customReportType" required>
                            <option value="">Select report type...</option>
                            <option value="equipment">Equipment Analysis</option>
                            <option value="technician">Technician Performance</option>
                            <option value="task">Task Analysis</option>
                            <option value="inventory">Inventory Report</option>
                            <option value="maintenance">Maintenance Summary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date Range</label>
                        <select class="form-control" id="customReportRange" required>
                            <option value="week">Last Week</option>
                            <option value="month">Last Month</option>
                            <option value="quarter">Last Quarter</option>
                            <option value="year">Last Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                </div>
                <div class="form-row" id="customDateRange" style="display: none;">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" class="form-control" id="customStartDate">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" class="form-control" id="customEndDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>Output Format</label>
                    <div style="display: flex; gap: 1rem;">
                        <button type="button" class="btn" onclick="generateCustomReport('pdf')">
                            <i class="fas fa-file-pdf"></i>
                            Generate PDF
                        </button>
                        <button type="button" class="btn btn-success" onclick="generateCustomReport('excel')">
                            <i class="fas fa-file-excel"></i>
                            Generate Excel
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics-section" class="section hidden">
        <h1 style="margin-bottom: 2rem; color: var(--gray-dark);">Advanced Analytics</h1>

        <div class="charts-grid">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Equipment Downtime Analysis</h3>
                <div class="chart-container">
                    <canvas id="downtimeAnalysisChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Maintenance Cost Trends</h3>
                <div class="chart-container">
                    <canvas id="costTrendsChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Task Response Times</h3>
                <div class="chart-container">
                    <canvas id="responseTimesChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Preventive vs Corrective Maintenance</h3>
                <div class="chart-container">
                    <canvas id="maintenanceTypesChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Equipment Reliability Trends</h3>
                <div class="chart-container">
                    <canvas id="reliabilityTrendsChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Spare Parts Usage</h3>
                <div class="chart-container">
                    <canvas id="sparePartsUsageChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 1.5rem;">Key Performance Indicators</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon equipment">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="overallEfficiency">0%</h3>
                        <p>Overall Efficiency</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon tasks">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="avgResponseTime">0h</h3>
                        <p>Avg Response Time</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon technicians">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="equipmentUptime">0%</h3>
                        <p>Equipment Uptime</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon inventory">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="costReduction">0%</h3>
                        <p>Cost Reduction</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Notifications Section -->
    <section id="notifications-section" class="section hidden">
        <h1 style="margin-bottom: 2rem; color: var(--gray-dark);">Notifications</h1>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3>System Notifications</h3>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary" onclick="markAllNotificationsAsRead()">
                        <i class="fas fa-check-double"></i>
                        Mark All as Read
                    </button>
                    <button class="btn" onclick="refreshNotifications()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div id="notificationsList">
                <p style="color: var(--gray-medium);">Loading notifications...</p>
            </div>
        </div>
    </section>

    <!-- Export Data Section -->
    <section id="export-section" class="section hidden">
        <h1 style="margin-bottom: 2rem; color: var(--gray-dark);">Export Data</h1>

        <div class="form-grid">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Equipment Data Export</h3>
                <p style="color: var(--gray-medium); margin-bottom: 1rem;">Export complete equipment database including maintenance history, specifications, and status.</p>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn" onclick="exportAllData('equipment', 'pdf')">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                    <button class="btn btn-success" onclick="exportAllData('equipment', 'excel')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportAllData('equipment', 'csv')">
                        <i class="fas fa-file-csv"></i>
                        Export CSV
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Maintenance Tasks Export</h3>
                <p style="color: var(--gray-medium); margin-bottom: 1rem;">Export all maintenance tasks with assignments, progress, and completion data.</p>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn" onclick="exportAllData('tasks', 'pdf')">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                    <button class="btn btn-success" onclick="exportAllData('tasks', 'excel')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportAllData('tasks', 'csv')">
                        <i class="fas fa-file-csv"></i>
                        Export CSV
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Staff Data Export</h3>
                <p style="color: var(--gray-medium); margin-bottom: 1rem;">Export staff information including roles, skills, and performance metrics.</p>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn" onclick="exportAllData('staff', 'pdf')">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                    <button class="btn btn-success" onclick="exportAllData('staff', 'excel')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportAllData('staff', 'csv')">
                        <i class="fas fa-file-csv"></i>
                        Export CSV
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Inventory Export</h3>
                <p style="color: var(--gray-medium); margin-bottom: 1rem;">Export complete inventory data including stock levels, values, and transaction history.</p>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn" onclick="exportAllData('inventory', 'pdf')">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                    <button class="btn btn-success" onclick="exportAllData('inventory', 'excel')">
                        <i class="fas fa-file-excel"></i>
                        Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportAllData('inventory', 'csv')">
                        <i class="fas fa-file-csv"></i>
                        Export CSV
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1.5rem;">Complete Database Backup</h3>
                <p style="color: var(--gray-medium); margin-bottom: 1rem;">Export all data from the system as a complete backup.</p>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-warning" onclick="exportCompleteBackup()">
                        <i class="fas fa-database"></i>
                        Full Backup
                    </button>
                    <button class="btn btn-success" onclick="exportAllData('complete', 'excel')">
                        <i class="fas fa-file-excel"></i>
                        Complete Excel Export
                    </button>
                </div>
            </div>
        </div>
    </section>
</main>





<!-- Equipment Modal -->
<div id="equipmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="equipmentModalTitle">Add Equipment</h2>
            <button class="close-btn" onclick="closeModal('equipmentModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="equipmentForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Equipment Name *</label>
                    <input type="text" class="form-control" id="equipmentName" required>
                </div>
                <div class="form-group">
                    <label>Model *</label>
                    <input type="text" class="form-control" id="equipmentModel" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Serial Number *</label>
                    <input type="text" class="form-control" id="equipmentSerial" required>
                </div>
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" class="form-control" id="equipmentLocation" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Installation Date</label>
                    <input type="date" class="form-control" id="equipmentInstallDate">
                </div>
                <div class="form-group">
                    <label>Status *</label>
                    <select class="form-control" id="equipmentStatus" required>
                        <option value="OPERATIONAL">Operational</option>
                        <option value="UNDER_MAINTENANCE">Under Maintenance</option>
                        <option value="DEFECTIVE">Defective</option>
                        <option value="RETIRED">Retired</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Last Maintenance Date</label>
                    <input type="date" class="form-control" id="equipmentLastMaintenanceDate">
                </div>
                <div class="form-group">
                    <label>Inventory Item</label>
                    <select class="form-control" id="equipmentInventoryId">
                        <option value="">Select Inventory Item</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
            </div>
            <button type="submit" class="btn">
                <i class="fas fa-save"></i>
                Save Equipment
            </button>
        </form>
    </div>
</div>

<!-- View Equipment Modal -->
<div id="viewEquipmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Equipment Details</h2>
            <button class="close-btn" onclick="closeModal('viewEquipmentModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="equipment-details">
            <div class="detail-row">
                <span class="detail-label">Name:</span>
                <span class="detail-value" id="viewEquipmentName"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Model:</span>
                <span class="detail-value" id="viewEquipmentModel"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Serial Number:</span>
                <span class="detail-value" id="viewEquipmentSerial"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Location:</span>
                <span class="detail-value" id="viewEquipmentLocation"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Status:</span>
                <span class="detail-value" id="viewEquipmentStatus"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Installation Date:</span>
                <span class="detail-value" id="viewEquipmentInstallDate"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Last Maintenance:</span>
                <span class="detail-value" id="viewEquipmentLastMaintenance"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Inventory ID:</span>
                <span class="detail-value" id="viewEquipmentInventoryId"></span>
            </div>
            <div class="detail-row full-width">
                <span class="detail-label">Description:</span>
                <span class="detail-value" id="viewEquipmentDescription"></span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeModal('viewEquipmentModal')">
                <i class="fas fa-times"></i>
                Close
            </button>
        </div>
    </div>
</div>

<!-- Task Modal -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Create/Edit Task</h2>
            <button class="close-btn" onclick="closeModal('taskModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="taskForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Task ID</label>
                    <input type="text" class="form-control" id="taskId" required>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select class="form-control" id="taskPriority" required>
                        <option value="HIGH">High</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="LOW">Low</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" id="taskDescription" rows="3" required></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Equipment</label>
                    <select class="form-control" id="taskEquipment">
                        <option value="">Select Equipment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estimated Duration (minutes)</label>
                    <input type="number" class="form-control" id="taskDuration" min="15" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Assigned Technician</label>
                    <select class="form-control" id="taskTechnician">
                        <option value="">Select Technician</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="datetime-local" class="form-control" id="taskDueDate">
                </div>
            </div>
            <div class="form-group">
                <label>Required Skills (comma-separated)</label>
                <input type="text" class="form-control" id="taskSkills" placeholder="e.g., Electrical, Mechanical, Hydraulic">
            </div>
            <div class="form-group">
                <label>Required Parts (comma-separated)</label>
                <input type="text" class="form-control" id="taskParts" placeholder="e.g., Filter, Gasket, Belt">
            </div>
            <button type="submit" class="btn">
                <i class="fas fa-save"></i>
                Save Task
            </button>
        </form>
    </div>
</div>







<!-- Updated Staff Modal -->
<div id="staffModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Add/Edit Staff</h2>
            <button class="close-btn" onclick="closeModal('staffModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="staffForm">
            <div class="form-row">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" class="form-control" id="staffFirstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" class="form-control" id="staffLastName" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-control" id="staffEmail" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" class="form-control" id="staffPhone" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Role</label>
                    <select class="form-control" id="staffRole" required>
                        <option value="ADMIN">Admin</option>
                        <option value="TECHNICIAN">Technician</option>
                        <option value="DRIVER">Driver</option>
                        <option value="PASSENGER">Passenger</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" id="staffPassword" required minlength="8">
                </div>
            </div>
            <div class="form-group">
                <label>Photo (optional)</label>
                <input type="file" class="form-control" id="staffPhoto" accept="image/*">
            </div>
            <button type="submit" class="btn">
                <i class="fas fa-save"></i>
                Save Staff
            </button>
        </form>
    </div>
</div>



<!-- View Task Modal -->
<div id="viewTaskModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2 class="modal-title">Task Details</h2>
            <button class="close-btn" onclick="closeModal('viewTaskModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="task-details" style="padding: 2rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div>
                    <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Task Information</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <p><strong>Task ID:</strong></p>
                            <p><strong>Description:</strong></p>
                            <p><strong>Priority:</strong></p>
                            <p><strong>Status:</strong></p>
                            <p><strong>Created:</strong></p>
                            <p><strong>Due Date:</strong></p>
                        </div>
                        <div>
                            <p id="viewTaskId">N/A</p>
                            <p id="viewTaskDescription">N/A</p>
                            <p id="viewTaskPriority">N/A</p>
                            <p id="viewTaskStatus">N/A</p>
                            <p id="viewTaskCreated">N/A</p>
                            <p id="viewTaskDueDate">N/A</p>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Assignment</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <p><strong>Assigned To:</strong></p>
                            <p><strong>Equipment:</strong></p>
                            <p><strong>Duration:</strong></p>
                            <p><strong>Progress:</strong></p>
                        </div>
                        <div>
                            <p id="viewTaskTechnician">N/A</p>
                            <p id="viewTaskEquipment">N/A</p>
                            <p id="viewTaskDuration">N/A</p>
                            <p id="viewTaskProgress">N/A</p>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 2rem;">
                <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Actions</h3>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn" onclick="editTaskFromView()">
                        <i class="fas fa-edit"></i> Edit Task
                    </button>
                    <button class="btn btn-danger" onclick="deleteTaskFromView()">
                        <i class="fas fa-trash"></i> Delete Task
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Spare Part Modal -->
<div id="sparePartModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Add/Edit Spare Part</h2>
            <button class="close-btn" onclick="closeModal('sparePartModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="sparePartForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Part Number</label>
                    <input type="text" class="form-control" id="partNumber" required>
                </div>
                <div class="form-group">
                    <label>Part Name</label>
                    <input type="text" class="form-control" id="partName" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" class="form-control" id="partCategory" required>
                </div>
                <div class="form-group">
                    <label>Supplier</label>
                    <input type="text" class="form-control" id="partSupplier" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Stock Quantity</label>
                    <input type="number" class="form-control" id="partStockQuantity" min="0" required>
                </div>
                <div class="form-group">
                    <label>Minimum Stock Level</label>
                    <input type="number" class="form-control" id="partMinStock" min="0" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Unit Price</label>
                    <input type="number" class="form-control" id="partUnitPrice" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Storage Location</label>
                    <input type="text" class="form-control" id="partLocation" required>
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" id="partDescription" rows="3"></textarea>
            </div>
            <button type="submit" class="btn">
                <i class="fas fa-save"></i>
                Save Spare Part
            </button>
        </form>
    </div>
</div>





<!-- Updated Inventory Modal -->
<div id="inventoryModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Add/Edit Inventory Item</h2>
            <button class="close-btn" onclick="closeModal('inventoryModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="inventoryForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Inventory Code *</label>
                    <input type="text" class="form-control" id="inventoryCode" required>
                </div>
                <div class="form-group">
                    <label>Item Name *</label>
                    <input type="text" class="form-control" id="inventoryName" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Type *</label>
                    <select class="form-control" id="inventoryType" required>
                        <option value="EQUIPMENT">Equipment</option>
                        <option value="SPARE_PART">Spare Part</option>
                        <option value="CONSUMABLE">Consumable</option>
                        <option value="TOOL">Tool</option>
                        <option value="ACCESSORY">Accessory</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Unit Cost *</label>
                    <input type="number" class="form-control" id="inventoryUnitPrice" step="0.01" min="0" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Initial Quantity *</label>
                    <input type="number" class="form-control" id="inventoryQuantity" min="0" required>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" class="form-control" id="inventoryLocation">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" class="form-control" id="inventoryCategory">
                </div>
                <div class="form-group">
                    <label>Minimum Threshold</label>
                    <input type="number" class="form-control" id="inventoryMinStock" min="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Maximum Threshold</label>
                    <input type="number" class="form-control" id="inventoryMaxStock" min="0">
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" id="inventoryDescription" rows="3"></textarea>
            </div>
            <button type="submit" class="btn">
                <i class="fas fa-save"></i>
                Save Inventory Item
            </button>
        </form>
    </div>
</div>



<script>
    // Global variables
    let currentUser = null;
    let charts = {};
    let notifications = [];
    let realTimeInterval = null;
    let equipmentData = [];
    let tasksData = [];
    let staffData = [];
    let sparePartsData = [];
    let inventoryData = [];

    const API_BASE = 'http://localhost:8080/api';

    // Initialize application
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Initializing IMAS Admin Dashboard...');

        initializeUser();
        initializeEventListeners();
        loadDashboardData();
        startRealTimeUpdates();

        // Set active section
        showSection('dashboard');
    });

    // Initialize user
    function initializeUser() {
        const userSession = localStorage.getItem('adminSession');
        if (userSession) {
            currentUser = JSON.parse(userSession);
        } else {
            currentUser = {
                id: 1,
                firstName: 'Admin',
                lastName: 'User',
                email: 'admin@imas.com',
                role: 'ADMIN'
            };
            localStorage.setItem('adminSession', JSON.stringify(currentUser));
        }

        document.getElementById('userName').textContent = currentUser.firstName + ' ' + currentUser.lastName;
        document.getElementById('userAvatar').textContent = currentUser.firstName.charAt(0);
    }

    // Initialize event listeners
    function initializeEventListeners() {
        document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // Form submissions
        document.getElementById('equipmentForm')?.addEventListener('submit', handleEquipmentSubmit);
        document.getElementById('taskForm')?.addEventListener('submit', handleTaskSubmit);
        document.getElementById('staffForm')?.addEventListener('submit', handleStaffSubmit);
        document.getElementById('sparePartForm')?.addEventListener('submit', handleSparePartSubmit);
        document.getElementById('inventoryForm')?.addEventListener('submit', handleInventorySubmit);
        document.getElementById('quickAssignForm')?.addEventListener('submit', handleQuickAssign);

        // Custom report range toggle
        document.getElementById('customReportRange')?.addEventListener('change', function() {
            const customRange = document.getElementById('customDateRange');
            if (this.value === 'custom') {
                customRange.style.display = 'block';
            } else {
                customRange.style.display = 'none';
            }
        });
    }

    // Start real-time updates
    function startRealTimeUpdates() {
        realTimeInterval = setInterval(async () => {
            await updateRealTimeData();
        }, 30000); // Update every 30 seconds
    }

    // Update real-time data
    async function updateRealTimeData() {
        try {
            const currentSection = document.querySelector('.section:not(.hidden)');
            if (currentSection) {
                const sectionId = currentSection.id.replace('-section', '');

                switch(sectionId) {
                    case 'dashboard':
                        await loadDashboardStats();
                        break;
                    case 'equipment':
                        await loadEquipmentData();
                        break;
                    case 'tasks':
                        await loadTasksData();
                        break;
                    case 'staff':
                        await loadStaffData();
                        break;
                    case 'notifications':
                        await loadNotifications();
                        break;
                }
            }

            // Always update notifications count
            await updateNotificationCount();

        } catch (error) {
            console.error('Real-time update error:', error);
        }
    }

    // Load dashboard data
    async function loadDashboardData() {
        try {
            await Promise.all([
                loadDashboardStats(),
                loadEquipmentData(),
                loadTasksData(),
                loadStaffData(),
                loadSparePartsData(),
                loadInventoryData(),
                loadNotifications()
            ]);

            createDashboardCharts();
            loadRecentActivities();

        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showNotification('Error loading dashboard data', 'error');
        }
    }

    // Load dashboard statistics
    async function loadDashboardStats() {
        try {
            // Load equipment stats
            const equipmentResponse = await fetchData('/equipments');
            equipmentData = equipmentResponse;
            document.getElementById('totalEquipment').textContent = equipmentData.length;

            // Load tasks stats
            const tasksResponse = await fetchData('/tasks');
            tasksData = tasksResponse;
            document.getElementById('totalTasks').textContent = tasksData.length;

            // Load staff stats (filter technicians)
            const staffResponse = await fetchData('/staff');
            staffData = staffResponse;
            const technicians = staffData.filter(staff => staff.role === 'TECHNICIAN');
            document.getElementById('totalTechnicians').textContent = technicians.length;

            // Load inventory stats
            const inventoryResponse = await fetchData('/inventory');
            inventoryData = inventoryResponse;
            document.getElementById('totalInventory').textContent = inventoryData.length;

        } catch (error) {
            console.error('Error loading dashboard stats:', error);
        }
    }








    // View equipment details
async function viewEquipment(equipmentId) {
    const equipment = equipmentData.find(eq => eq.equipmentId == equipmentId);
    if (!equipment) return;

    // Create modal content
    const modalContent = `
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Equipment Details</h2>
                <button class="close-btn" onclick="closeModal('viewEquipmentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Basic Information</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <p><strong>Name:</strong></p>
                                <p><strong>Model:</strong></p>
                                <p><strong>Serial Number:</strong></p>
                                <p><strong>Location:</strong></p>
                            </div>
                            <div>
                                <p>${equipment.name || 'N/A'}</p>
                                <p>${equipment.model || 'N/A'}</p>
                                <p>${equipment.serialNumber || 'N/A'}</p>
                                <p>${equipment.location || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Status Information</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <p><strong>Status:</strong></p>
                                <p><strong>Installation Date:</strong></p>
                                <p><strong>Last Maintenance:</strong></p>
                                <p><strong>Inventory ID:</strong></p>
                            </div>
                            <div>
                                <p><span class="status-badge ${getStatusClass(equipment.status)}">${equipment.status || 'N/A'}</span></p>
                                <p>${equipment.installationDate ? new Date(equipment.installationDate).toLocaleDateString() : 'N/A'}</p>
                                <p>${equipment.lastMaintenanceDate ? new Date(equipment.lastMaintenanceDate).toLocaleDateString() : 'Never'}</p>
                                <p>${equipment.inventoryId || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Actions</h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn" onclick="editEquipment(${equipment.equipmentId}); closeModal('viewEquipmentModal')">
                            <i class="fas fa-edit"></i> Edit Equipment
                        </button>
                        <button class="btn btn-danger" onclick="deleteEquipment(${equipment.equipmentId}); closeModal('viewEquipmentModal')">
                            <i class="fas fa-trash"></i> Delete Equipment
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;

    // Create or update modal
    let modal = document.getElementById('viewEquipmentModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'viewEquipmentModal';
        modal.className = 'modal';
        document.body.appendChild(modal);
    }
    modal.innerHTML = modalContent;
    modal.classList.add('active');
}






async function loadEquipmentData() {
    try {
        const response = await fetchData('/equipments');
        equipmentData = response;

        // 1. Populate equipment combo box for TASKS (taskEquipment)
        const taskEquipmentSelect = document.getElementById('taskEquipment');
        if (taskEquipmentSelect) {
            taskEquipmentSelect.innerHTML = '<option value="">Select Equipment</option>';
            equipmentData.forEach(equipment => {
                const option = document.createElement('option');
                option.value = equipment.equipmentId;
                option.textContent = `${equipment.name} (${equipment.serialNumber}) - ${equipment.location}`;
                taskEquipmentSelect.appendChild(option);
            });
        }

        // 2. Populate equipment combo box for QUICK ASSIGNMENT if it exists
        const assignEquipmentSelect = document.getElementById('assignEquipmentSelect');
        if (assignEquipmentSelect) {
            assignEquipmentSelect.innerHTML = '<option value="">Select Equipment</option>';
            equipmentData.forEach(equipment => {
                const option = document.createElement('option');
                option.value = equipment.equipmentId;
                option.textContent = `${equipment.name} (${equipment.serialNumber}) - ${equipment.location}`;
                assignEquipmentSelect.appendChild(option);
            });
        }

        // 3. Load inventory options for equipment form (equipmentInventoryId)
        await loadInventoryOptions();

        // 4. Display equipment data in table
        displayEquipmentData();

    } catch (error) {
        console.error('Error loading equipment data:', error);
        showNotification('Error loading equipment data', 'error');
    }
}










// Display equipment data
function displayEquipmentData(filteredData = null) {
    const tbody = document.getElementById('equipmentTableBody');
    if (!tbody) return;

    const dataToDisplay = filteredData || equipmentData;

    if (dataToDisplay.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--gray-medium);">No equipment found</td></tr>';
        return;
    }

    tbody.innerHTML = dataToDisplay.map(equipment => `
        <tr>
            <td>${equipment.equipmentId}</td>
            <td>${equipment.name || 'N/A'}</td>
            <td>${equipment.model || 'N/A'}</td>
            <td>${equipment.serialNumber || 'N/A'}</td>
            <td>${equipment.location || 'N/A'}</td>
            <td><span class="status-badge ${getStatusClass(equipment.status)}">${equipment.status || 'Unknown'}</span></td>
            <td>${equipment.lastMaintenanceDate ? new Date(equipment.lastMaintenanceDate).toLocaleDateString() : 'Never'}</td>
            <td>${equipment.inventoryId || 'N/A'}</td>
            <td>
                <div class="action-buttons">
                    <button class="action-btn view" onclick="viewEquipment(${equipment.equipmentId})" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn edit" onclick="editEquipment(${equipment.equipmentId})" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" onclick="deleteEquipment(${equipment.equipmentId})" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
    `).join('');
}






    // Load tasks data
    async function loadTasksData() {
        try {
            const response = await fetchData('/tasks');
            tasksData = response;

            // Populate task select for assignment
            const taskSelect = document.getElementById('assignTaskSelect');
            if (taskSelect) {
                const unassignedTasks = tasksData.filter(task =>
                    task.status === 'PLANNED' || task.status === 'PENDING'
                );
                taskSelect.innerHTML = '<option value="">Select a task to assign...</option>' +
                    unassignedTasks.map(task =>
                        `<option value="${task.taskId}">${task.taskId} - ${task.description}</option>`
                    ).join('');
            }

            displayTasksData();

        } catch (error) {
            console.error('Error loading tasks data:', error);
            showNotification('Error loading tasks data', 'error');
        }
    }

    // Display tasks data
    function displayTasksData() {
        const tbody = document.getElementById('tasksTableBody');
        if (!tbody) return;

        if (tasksData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: var(--gray-medium);">No tasks found</td></tr>';
            return;
        }

        tbody.innerHTML = tasksData.map(task => `
            <tr>
                <td>${task.taskId}</td>
                <td>${task.description || 'N/A'}</td>
                <td>${task.relatedEquipment ? task.relatedEquipment.name : 'N/A'}</td>
                <td>${task.assignedTechnicianStaff ? task.assignedTechnicianStaff.firstName + ' ' + task.assignedTechnicianStaff.lastName : 'Unassigned'}</td>
                <td><span class="priority-badge ${task.priority?.toLowerCase()}">${task.priority || 'N/A'}</span></td>
                <td><span class="status-badge ${getTaskStatusClass(task.status)}">${task.status || 'N/A'}</span></td>
                <td>${task.creationDate ? new Date(task.creationDate).toLocaleDateString() : 'N/A'}</td>
                <td>${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'Not Set'}</td>
                <td>
                    <div style="width: 100%; background: var(--gray-light); border-radius: 10px; overflow: hidden;">
                        <div style="background: var(--primary-blue); height: 6px; width: ${task.completionPercentage || 0}%; transition: width 0.3s ease;"></div>
                    </div>
                    <small>${task.completionPercentage || 0}%</small>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn view" onclick="viewTask('${task.taskId}')" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editTask('${task.taskId}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteTask('${task.taskId}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `).join('');
    }



// Also add this function to ensure technician combo box is populated
async function loadTechnicianOptions() {
    try {
        const response = await fetchData('/staff');
        const technicians = response.filter(staff => staff.role === 'TECHNICIAN');

        // Populate technician combo box for TASKS
        const taskTechnicianSelect = document.getElementById('taskTechnician');
        if (taskTechnicianSelect) {
            taskTechnicianSelect.innerHTML = '<option value="">Select Technician</option>';
            technicians.forEach(tech => {
                const option = document.createElement('option');
                option.value = tech.id;
                option.textContent = `${tech.firstName} ${tech.lastName} (${tech.skills || 'No skills'})`;
                taskTechnicianSelect.appendChild(option);
            });
        }

        // Populate technician combo box for QUICK ASSIGNMENT
        const assignTechnicianSelect = document.getElementById('assignTechnicianSelect');
        if (assignTechnicianSelect) {
            assignTechnicianSelect.innerHTML = '<option value="">Select Technician</option>';
            technicians.forEach(tech => {
                const option = document.createElement('option');
                option.value = tech.id;
                option.textContent = `${tech.firstName} ${tech.lastName} (${tech.skills || 'No skills'})`;
                assignTechnicianSelect.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Error loading technician options:', error);
    }
}

// Modified loadStaffData function to also populate technician combos
async function loadStaffData() {
    try {
        const response = await fetchData('/staff');
        staffData = response;

        // Load technician options for all relevant combo boxes
        await loadTechnicianOptions();

        displayStaffData();
        loadTechnicianAvailability();

    } catch (error) {
        console.error('Error loading staff data:', error);
        showNotification('Error loading staff data', 'error');
    }
}





// Delete task
async function deleteTask(taskId) {
    if (!confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
        return;
    }

    try {
        const response = await fetch(`${API_BASE}/tasks/${taskId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': getAuthToken()
            }
        });

        if (response.ok) {
            showNotification('Task deleted successfully!', 'success');
            await loadTasksData();
        } else {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to delete task');
        }
    } catch (error) {
        console.error('Delete error:', error);
        showNotification('Failed to delete task: ' + error.message, 'error');
    }
}



    // Display staff data
    function displayStaffData() {
        const tbody = document.getElementById('staffTableBody');
        if (!tbody) return;

        if (staffData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--gray-medium);">No staff found</td></tr>';
            return;
        }

        tbody.innerHTML = staffData.map(staff => {
            const activeTasks = tasksData.filter(task =>
                task.assignedTechnicianStaff &&
                task.assignedTechnicianStaff.id === staff.id &&
                (task.status === 'ASSIGNED' || task.status === 'IN_PROGRESS')
            ).length;

            return `
                <tr>
                    <td>${staff.id}</td>
                    <td>${staff.firstName} ${staff.lastName}</td>
                    <td>${staff.email || 'N/A'}</td>
                    <td>${staff.phoneNumber || 'N/A'}</td>
                    <td><span class="status-badge ${staff.role?.toLowerCase()}">${staff.role || 'N/A'}</span></td>
                    <td>${staff.skills || 'No skills listed'}</td>
                    <td>${activeTasks}</td>
                    <td><span class="status-badge active">Active</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="viewStaff(${staff.id})" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="editStaff(${staff.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteStaff(${staff.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // Load spare parts data
    async function loadSparePartsData() {
        try {
            const response = await fetchData('/spare-parts');
            sparePartsData = response;

            // Populate category filter
            const categories = [...new Set(sparePartsData.map(part => part.category).filter(Boolean))];
            const categoryFilter = document.getElementById('sparePartCategoryFilter');
            if (categoryFilter) {
                categoryFilter.innerHTML = '<option value="">All Categories</option>' +
                    categories.map(category => `<option value="${category}">${category}</option>`).join('');
            }

            displaySparePartsData();

        } catch (error) {
            console.error('Error loading spare parts data:', error);
            showNotification('Error loading spare parts data', 'error');
        }
    }

    // Display spare parts data
    function displaySparePartsData() {
        const tbody = document.getElementById('sparePartsTableBody');
        if (!tbody) return;

        if (sparePartsData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: var(--gray-medium);">No spare parts found</td></tr>';
            return;
        }

        tbody.innerHTML = sparePartsData.map(part => {
            const stockStatus = getStockStatus(part.stockQuantity, part.minimumStockLevel);

            return `
                <tr>
                    <td>${part.partNumber}</td>
                    <td>${part.name}</td>
                    <td>${part.category}</td>
                    <td>${part.supplier}</td>
                    <td>${part.stockQuantity}</td>
                    <td>${part.minimumStockLevel}</td>
                    <td>$${part.unitPrice ? part.unitPrice.toFixed(2) : '0.00'}</td>
                    <td>${part.storageLocation}</td>
                    <td><span class="status-badge ${stockStatus.class}">${stockStatus.text}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="viewSparePart(${part.partId})" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="editSparePart(${part.partId})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteSparePart(${part.partId})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // Load inventory data
    async function loadInventoryData() {
        try {
            const response = await fetchData('/inventory');
            inventoryData = response;

            displayInventoryData();

        } catch (error) {
            console.error('Error loading inventory data:', error);
            showNotification('Error loading inventory data', 'error');
        }
    }




// Display inventory data
function displayInventoryData() {
    const tbody = document.getElementById('inventoryTableBody');
    if (!tbody) return;

    if (inventoryData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: var(--gray-medium);">No inventory items found</td></tr>';
        return;
    }

    tbody.innerHTML = inventoryData.map(item => {
        const totalValue = (item.totalQuantity || 0) * (item.unitCost || 0);
        const stockStatus = item.totalQuantity <= (item.minimumThreshold || 0) ? 'low-stock' :
                           item.totalQuantity >= (item.maximumThreshold || 999999) ? 'overstock' : 'normal';

        return `
            <tr class="${stockStatus}">
                <td>${item.inventoryCode || 'N/A'}</td>
                <td>${item.name || 'N/A'}</td>
                <td>${item.itemType || 'N/A'}</td>
                <td>${item.totalQuantity || 0}</td>
                <td>${item.availableQuantity || 0}</td>
                <td>${item.reservedQuantity || 0}</td>
                <td>${item.minimumThreshold || 0}</td>
                <td>${item.maximumThreshold || 0}</td>
                <td>$${item.unitCost ? item.unitCost.toFixed(2) : '0.00'}</td>
                <td>$${totalValue.toFixed(2)}</td>
                <td>${item.location || 'N/A'}</td>
                <td><span class="status-badge ${item.status?.toLowerCase() || 'active'}">${item.status || 'ACTIVE'}</span></td>
                <td>${item.lastUpdated ? new Date(item.lastUpdated).toLocaleDateString() : 'N/A'}</td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn view" onclick="viewInventory(${item.inventoryId})" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editInventory(${item.inventoryId})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteInventory(${item.inventoryId})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
    }).join('');
}




    // Load technician availability
    async function loadTechnicianAvailability() {
        const container = document.getElementById('technicianAvailability');
        if (!container) return;

        try {
            const technicians = staffData.filter(staff => staff.role === 'TECHNICIAN');

            if (technicians.length === 0) {
                container.innerHTML = '<p stylfe="color: var(--gray-medium);">No technicians found</p>';
                return;
            }

            const availabilityHTML = technicians.map(tech => {
                const activeTasks = tasksData.filter(task =>
                    task.assignedTechnicianStaff &&
                    task.assignedTechnicianStaff.id === tech.id &&
                    (task.status === 'ASSIGNED' || task.status === 'IN_PROGRESS')
                ).length;

                const workload = activeTasks === 0 ? 'Available' :
                               activeTasks <= 2 ? 'Light Load' :
                               activeTasks <= 4 ? 'Moderate Load' : 'Heavy Load';

                const workloadClass = activeTasks === 0 ? 'active' :
                                    activeTasks <= 2 ? 'pending' :
                                    activeTasks <= 4 ? 'in-progress' : 'inactive';

                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--gray-light);">
                        <div>
                            <strong>${tech.firstName} ${tech.lastName}</strong><br>
                            <small style="color: var(--gray-medium);">${tech.skills || 'No skills listed'}</small>
                        </div>
                        <div style="text-align: right;">
                            <span class="status-badge ${workloadClass}">${workload}</span><br>
                            <small>${activeTasks} active tasks</small>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = availabilityHTML;

        } catch (error) {
            console.error('Error loading technician availability:', error);
            container.innerHTML = '<p style="color: var(--secondary-red);">Error loading availability</p>';
        }
    }

    // Load recent activities
    async function loadRecentActivities() {
        const container = document.getElementById('recentActivities');
        if (!container) return;

        try {
            // Simulate recent activities from tasks and equipment data
            const recentActivities = [];

            // Add recent task updates
            const recentTasks = tasksData
                .filter(task => task.creationDate)
                .sort((a, b) => new Date(b.creationDate) - new Date(a.creationDate))
                .slice(0, 3);

            recentTasks.forEach(task => {
                recentActivities.push({
                    type: 'task',
                    message: `Task ${task.taskId} was ${task.status.toLowerCase()}`,
                    time: new Date(task.creationDate),
                    icon: 'fas fa-tasks',
                    color: 'var(--primary-blue)'
                });
            });

            // Add recent equipment updates
            const recentEquipment = equipmentData
                .filter(eq => eq.lastMaintenanceDate)
                .sort((a, b) => new Date(b.lastMaintenanceDate) - new Date(a.lastMaintenanceDate))
                .slice(0, 2);

            recentEquipment.forEach(eq => {
                recentActivities.push({
                    type: 'equipment',
                    message: `Equipment ${eq.name} maintenance completed`,
                    time: new Date(eq.lastMaintenanceDate),
                    icon: 'fas fa-tools',
                    color: 'var(--green)'
                });
            });

            // Sort by time
            recentActivities.sort((a, b) => b.time - a.time);

            if (recentActivities.length === 0) {
                container.innerHTML = '<p style="color: var(--gray-medium);">No recent activities</p>';
                return;
            }

            container.innerHTML = recentActivities.slice(0, 5).map(activity => `
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid var(--gray-light);">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: ${activity.color}; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="${activity.icon}"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--gray-dark);">${activity.message}</div>
                        <div style="font-size: 0.9rem; color: var(--gray-medium);">${formatTimeAgo(activity.time)}</div>
                    </div>
                </div>
            `).join('');

        } catch (error) {
            console.error('Error loading recent activities:', error);
            container.innerHTML = '<p style="color: var(--secondary-red);">Error loading activities</p>';
        }
    }

    // Load notifications
    async function loadNotifications() {
        try {
            // For admin, we'll aggregate notifications from different sources
            const response = await fetchData('/notifications/user/' + currentUser.id);
            notifications = response.map(notif => ({
                id: notif.id,
                title: notif.title || 'System Notification',
                message: notif.message,
                time: new Date(notif.timestamp || notif.time),
                read: notif.read,
                type: notif.type || 'system'
            }));

            updateNotificationCount();
            displayNotifications();

        } catch (error) {
            console.error('Error loading notifications:', error);
            notifications = [];
            updateNotificationCount();
        }
    }

    // Update notification count
    function updateNotificationCount() {
        const unreadCount = notifications.filter(n => !n.read).length;
        const badge = document.getElementById('notificationCount');
        badge.textContent = unreadCount;
        badge.style.display = unreadCount > 0 ? 'flex' : 'none';
    }

    // Display notifications
    function displayNotifications() {
        const container = document.getElementById('notificationsList');
        if (!container) return;

        if (notifications.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 4rem;">
                    <i class="fas fa-bell" style="font-size: 4rem; color: var(--gray-medium); margin-bottom: 1rem;"></i>
                    <h3 style="color: var(--gray-medium); margin-bottom: 0.5rem;">No notifications</h3>
                    <p style="color: var(--gray-medium);">System notifications will appear here.</p>
                </div>
            `;
            return;
        }

        container.innerHTML = notifications
            .sort((a, b) => new Date(b.time) - new Date(a.time))
            .map(notification => {
                let iconClass = 'fas fa-info-circle';
                let iconColor = 'var(--primary-blue)';

                switch (notification.type) {
                    case 'task-update':
                        iconClass = 'fas fa-tasks';
                        iconColor = 'var(--green)';
                        break;
                    case 'equipment-alert':
                        iconClass = 'fas fa-exclamation-triangle';
                        iconColor = 'var(--gold)';
                        break;
                    case 'maintenance-due':
                        iconClass = 'fas fa-wrench';
                        iconColor = 'var(--secondary-red)';
                        break;
                    case 'system':
                        iconClass = 'fas fa-cog';
                        iconColor = 'var(--gray-medium)';
                        break;
                }

                return `
                    <div class="notification-item ${!notification.read ? 'unread' : ''}" onclick="markNotificationAsRead('${notification.id}')">
                        <div class="notification-header">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="${iconClass}" style="color: ${iconColor};"></i>
                                <div class="notification-title">${notification.title}</div>
                            </div>
                            <div class="notification-time">${formatTimeAgo(new Date(notification.time))}</div>
                        </div>
                        <div class="notification-message">${notification.message}</div>
                        ${!notification.read ? '<div style="width: 8px; height: 8px; background: var(--primary-blue); border-radius: 50%; position: absolute; top: 1rem; right: 1rem;"></div>' : ''}
                    </div>
                `;
            }).join('');
    }

    // Mark notification as read
    async function markNotificationAsRead(notificationId) {
        try {
            const response = await fetch(`${API_BASE}/notifications/${notificationId}/read`, {
                method: 'PUT',
                headers: {
                    'Authorization': getAuthToken(),
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const notification = notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    updateNotificationCount();
                    displayNotifications();
                }
            }
        } catch (error) {
            console.error('Error marking notification as read:', error);
        }
    }

    // Mark all notifications as read
    async function markAllNotificationsAsRead() {
        try {
            const response = await fetch(`${API_BASE}/notifications/user/${currentUser.id}/read-all`, {
                method: 'PUT',
                headers: {
                    'Authorization': getAuthToken(),
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                notifications.forEach(n => n.read = true);
                updateNotificationCount();
                displayNotifications();
                showNotification('All notifications marked as read', 'success');
            }
        } catch (error) {
            console.error('Error marking all notifications as read:', error);
            showNotification('Error updating notifications', 'error');
        }
    }

    // Create dashboard charts
    function createDashboardCharts() {
        createEquipmentStatusChart();
        createTaskPriorityChart();
        createMonthlyMaintenanceChart();
        createTechnicianWorkloadChart();
    }

    // Create equipment status chart
    function createEquipmentStatusChart() {
        const ctx = document.getElementById('equipmentStatusChart');
        if (!ctx) return;

        destroyChart('equipmentStatus');

        const statusCounts = {};
        equipmentData.forEach(eq => {
            const status = eq.status || 'Unknown';
            statusCounts[status] = (statusCounts[status] || 0) + 1;
        });

        const statuses = Object.keys(statusCounts);
        const counts = Object.values(statusCounts);

        charts.equipmentStatus = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: statuses,
                datasets: [{
                    data: counts,
                    backgroundColor: [
                        '#10B981',  // Active - Green
                        '#F59E0B',  // Maintenance - Yellow
                        '#DC2626',  // Out of Order - Red
                        '#6B7280'   // Inactive - Gray
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    // Create task priority chart
    function createTaskPriorityChart() {
        const ctx = document.getElementById('taskPriorityChart');
        if (!ctx) return;

        destroyChart('taskPriority');

        const priorityCounts = {};
        tasksData.forEach(task => {
            const priority = task.priority || 'Unknown';
            priorityCounts[priority] = (priorityCounts[priority] || 0) + 1;
        });

        const priorities = Object.keys(priorityCounts);
        const counts = Object.values(priorityCounts);

        charts.taskPriority = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: priorities,
                datasets: [{
                    label: 'Task Count',
                    data: counts,
                    backgroundColor: [
                        '#DC2626',  // High - Red
                        '#F59E0B',  // Medium - Yellow
                        '#10B981'   // Low - Green
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Create monthly maintenance chart
    function createMonthlyMaintenanceChart() {
        const ctx = document.getElementById('monthlyMaintenanceChart');
        if (!ctx) return;

        destroyChart('monthlyMaintenance');

        // Generate data for last 6 months
        const months = [];
        const maintenanceCounts = [];
        const now = new Date();

        for (let i = 5; i >= 0; i--) {
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            months.push(date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }));

            const monthMaintenance = equipmentData.filter(eq => {
                if (!eq.lastMaintenanceDate) return false;
                const maintenanceDate = new Date(eq.lastMaintenanceDate);
                return maintenanceDate.getMonth() === date.getMonth() &&
                       maintenanceDate.getFullYear() === date.getFullYear();
            }).length;

            maintenanceCounts.push(monthMaintenance);
        }

        charts.monthlyMaintenance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Maintenance Activities',
                    data: maintenanceCounts,
                    borderColor: '#1E40AF',
                    backgroundColor: 'rgba(30, 64, 175, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Create technician workload chart
    function createTechnicianWorkloadChart() {
        const ctx = document.getElementById('technicianWorkloadChart');
        if (!ctx) return;

        destroyChart('technicianWorkload');

        const technicians = staffData.filter(staff => staff.role === 'TECHNICIAN');
        const technicianNames = technicians.map(tech => `${tech.firstName} ${tech.lastName}`);
        const workloads = technicians.map(tech => {
            return tasksData.filter(task =>
                task.assignedTechnicianStaff &&
                task.assignedTechnicianStaff.id === tech.id &&
                (task.status === 'ASSIGNED' || task.status === 'IN_PROGRESS')
            ).length;
        });

        charts.technicianWorkload = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: technicianNames,
                datasets: [{
                    label: 'Active Tasks',
                    data: workloads,
                    backgroundColor: 'rgba(30, 64, 175, 0.8)',
                    borderColor: '#1E40AF',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    }

    // Destroy chart if exists
    function destroyChart(chartKey) {
        if (charts[chartKey]) {
            charts[chartKey].destroy();
            charts[chartKey] = null;
        }
    }













// Handle equipment form submission
async function handleEquipmentSubmit(e) {
    e.preventDefault();

    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;

    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="loading"></div> Saving...';

        const formData = {
            name: document.getElementById('equipmentName').value,
            model: document.getElementById('equipmentModel').value,
            serialNumber: document.getElementById('equipmentSerial').value,
            location: document.getElementById('equipmentLocation').value,
            installationDate: document.getElementById('equipmentInstallDate').value || null,
            status: document.getElementById('equipmentStatus').value,
            lastMaintenanceDate: document.getElementById('equipmentLastMaintenanceDate').value || null,
            inventoryId: document.getElementById('equipmentInventoryId').value || null
        };

        const equipmentId = e.target.dataset.equipmentId;
        let response;

        if (equipmentId) {
            // Update existing equipment
            response = await fetch(`${API_BASE}/equipments/${equipmentId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': getAuthToken()
                },
                body: JSON.stringify(formData)
            });
        } else {
            // Create new equipment
            response = await fetch(`${API_BASE}/equipments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': getAuthToken()
                },
                body: JSON.stringify(formData)
            });
        }

        if (response.ok) {
            showNotification('Equipment saved successfully!', 'success');
            closeModal('equipmentModal');
            e.target.reset();
            delete e.target.dataset.equipmentId;
            await loadEquipmentData();
        } else {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to save equipment');
        }

    } catch (error) {
        console.error('Equipment save error:', error);
        showNotification('Failed to save equipment: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}




// Fonction pour charger les données d'équipement dans le formulaire (pour l'édition)
function loadEquipmentForEdit(equipment) {
    document.getElementById('equipmentName').value = equipment.name || '';
    document.getElementById('equipmentModel').value = equipment.model || '';
    document.getElementById('equipmentSerial').value = equipment.serialNumber || '';
    document.getElementById('equipmentLocation').value = equipment.location || '';
    document.getElementById('equipmentInstallDate').value = equipment.installationDate || '';
    document.getElementById('equipmentStatus').value = equipment.status || 'OPERATIONAL';
    document.getElementById('equipmentLastMaintenanceDate').value = equipment.lastMaintenanceDate || '';
    document.getElementById('equipmentInventoryId').value = equipment.inventoryId || '';
}

// Assurez-vous d'attacher l'event listener au formulaire
document.addEventListener('DOMContentLoaded', function() {
    const equipmentForm = document.getElementById('equipmentForm');
    if (equipmentForm) {
        equipmentForm.addEventListener('submit', handleEquipmentSubmit);
    }
});




// Initialize the form event listener
document.addEventListener('DOMContentLoaded', function() {
    const staffForm = document.getElementById('staffForm');
    if (staffForm) {
        staffForm.addEventListener('submit', handleStaffSubmit);
    }
});



// Handle task form submission
async function handleTaskSubmit(e) {
    e.preventDefault();

    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;

    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="loading"></div> Saving...';

        // Validate due date
        const dueDateInput = document.getElementById('taskDueDate');
        if (dueDateInput.value) {
            const dueDate = new Date(dueDateInput.value);
            const now = new Date();
            if (dueDate < now) {
                throw new Error("Due date cannot be in the past");
            }
        }

        const formData = {
            taskId: document.getElementById('taskId').value,
            description: document.getElementById('taskDescription').value,
            priority: document.getElementById('taskPriority').value,
            estimatedDurationMinutes: parseInt(document.getElementById('taskDuration').value),
            equipmentId: document.getElementById('taskEquipment').value || null,
            technicianId: document.getElementById('taskTechnician').value || null,
            dueDate: dueDateInput.value || null,
            requiredSkills: document.getElementById('taskSkills').value.split(',').filter(s => s.trim()).map(s => s.trim()),
            requiredParts: document.getElementById('taskParts').value.split(',').filter(s => s.trim()).map(s => s.trim())
        };

        // Check if we're updating an existing task
        const isUpdate = e.target.dataset.taskId !== undefined;
        const method = isUpdate ? 'PUT' : 'POST';
        const url = isUpdate ? `${API_BASE}/tasks/${e.target.dataset.taskId}` : `${API_BASE}/tasks`;

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': getAuthToken()
            },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to save task');
        }

        const task = await response.json();
        showNotification(`Task ${isUpdate ? 'updated' : 'created'} successfully!`, 'success');
        closeModal('taskModal');
        e.target.reset();
        delete e.target.dataset.taskId;
        await loadTasksData();

    } catch (error) {
        console.error('Task save error:', error);
        showNotification('Failed to save task: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}




// Handle staff form submission
async function handleStaffSubmit(e) {
    e.preventDefault();

    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;

    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="loading"></div> Saving...';

        // Validate required fields
        const firstName = document.getElementById('staffFirstName').value.trim();
        const lastName = document.getElementById('staffLastName').value.trim();
        const email = document.getElementById('staffEmail').value.trim();
        const phoneNumber = document.getElementById('staffPhone').value.trim();
        const role = document.getElementById('staffRole').value;
        const password = document.getElementById('staffPassword').value;

        if (!firstName || !lastName || !email || !phoneNumber || !role || !password) {
            throw new Error('All required fields must be filled');
        }

        if (password.length < 8) {
            throw new Error('Password must be at least 8 characters long');
        }

        // Create FormData object for multipart/form-data
        const formData = new FormData();
        formData.append('firstName', firstName);
        formData.append('lastName', lastName);
        formData.append('email', email);
        formData.append('phoneNumber', phoneNumber);
        formData.append('role', role);
        formData.append('password', password);

        // Handle photo upload if present
        const photoInput = document.getElementById('staffPhoto');
        if (photoInput.files.length > 0) {
            const file = photoInput.files[0];

            // Validate file size (2MB max)
            if (file.size > 2 * 1024 * 1024) {
                throw new Error('Photo size must be less than 2MB');
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                throw new Error('Only image files are allowed');
            }

            formData.append('photo', file);
        }

        // Prepare headers - add auth token only if available
        const headers = {};
        const token = getAuthToken();

        if (token) {
            headers['Authorization'] = `Bearer ${token}`;
            console.log('Using authentication token');
        } else {
            console.log('No token found - proceeding without authentication');
        }

        const response = await fetch(`${API_BASE}/staff`, {
            method: 'POST',
            headers: headers,
            body: formData
        });

        if (response.ok) {
            const result = await response.json();
            showNotification('Staff member added successfully!', 'success');
            closeModal('staffModal');
            e.target.reset();
            if (typeof loadStaffData === 'function') {
                await loadStaffData();
            }
        } else {
            let errorMessage = 'Failed to add staff member';
            try {
                const errorData = await response.json();
                errorMessage = errorData.message || errorMessage;
            } catch (e) {
                // If response is not JSON, use status text
                errorMessage = `${response.status} - ${response.statusText}` || errorMessage;
            }
            throw new Error(errorMessage);
        }

    } catch (error) {
        console.error('Staff creation error:', error);
        showNotification('Failed to add staff member: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}




// Handle spare part form submission
async function handleSparePartSubmit(e) {
    e.preventDefault();

    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;

    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="loading"></div> Saving...';

        const formData = {
            partNumber: document.getElementById('partNumber').value,
            name: document.getElementById('partName').value,
            category: document.getElementById('partCategory').value,
            supplier: document.getElementById('partSupplier').value,
            quantity: parseInt(document.getElementById('partStockQuantity').value), // Changed from stockQuantity to quantity
            minimumStockLevel: parseInt(document.getElementById('partMinStock').value),
            unitPrice: parseFloat(document.getElementById('partUnitPrice').value),
            storageLocation: document.getElementById('partLocation').value,
            description: document.getElementById('partDescription').value
        };

        const response = await fetch(`${API_BASE}/spare-parts`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': getAuthToken()
            },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            showNotification('Spare part added successfully!', 'success');
            closeModal('sparePartModal');
            e.target.reset();
            await loadSparePartsData();
        } else {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to add spare part');
        }

    } catch (error) {
        console.error('Spare part creation error:', error);
        showNotification('Failed to add spare part: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}






// Handle inventory form submission
async function handleInventorySubmit(e) {
    e.preventDefault();

    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;

    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="loading"></div> Saving...';

        const formData = {
            inventoryCode: document.getElementById('inventoryCode').value, // Fixed: was itemCode
            name: document.getElementById('inventoryName').value, // Fixed: was itemName
            itemType: document.getElementById('inventoryType').value,
            unitCost: parseFloat(document.getElementById('inventoryUnitPrice').value), // Fixed: was unitPrice
            totalQuantity: parseInt(document.getElementById('inventoryQuantity').value), // Fixed: was currentQuantity
            availableQuantity: parseInt(document.getElementById('inventoryQuantity').value), // Added
            reservedQuantity: 0, // Added
            minimumThreshold: parseInt(document.getElementById('inventoryMinStock').value), // Fixed: was minimumStockLevel
            maximumThreshold: parseInt(document.getElementById('inventoryMaxStock').value), // Fixed: was maximumStockLevel
            description: document.getElementById('inventoryDescription').value,
            status: 'ACTIVE', // Added required field
            location: document.getElementById('inventoryLocation')?.value || '', // Added if you have location field
            category: document.getElementById('inventoryCategory')?.value || '' // Added if you have category field
        };

        const response = await fetch(`${API_BASE}/inventory`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': getAuthToken()
            },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            showNotification('Inventory item added successfully!', 'success');
            closeModal('inventoryModal');
            e.target.reset();
            await loadInventoryData();
        } else {
            const errorText = await response.text();
            throw new Error(`Failed to add inventory item: ${errorText}`);
        }

    } catch (error) {
        console.error('Inventory creation error:', error);
        showNotification('Failed to add inventory item: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}






    // Handle quick task assignment
    async function handleQuickAssign(e) {
        e.preventDefault();

        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;

        try {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading"></div> Assigning...';

            const taskId = document.getElementById('assignTaskSelect').value;
            const technicianId = document.getElementById('assignTechnicianSelect').value;
            const dueDate = document.getElementById('assignDueDate').value;
            const notes = document.getElementById('assignNotes').value;

            // Assign technician to task
            const response = await fetch(`${API_BASE}/tasks/${taskId}/staff-technician`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': getAuthToken()
                },
                body: JSON.stringify({
                    technicianId: parseInt(technicianId)
                })
            });

            if (response.ok) {
                // Update due date if provided
                if (dueDate) {
                    await fetch(`${API_BASE}/tasks/${taskId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': getAuthToken()
                        },
                        body: JSON.stringify({
                            dueDate: dueDate
                        })
                    });
                }

                showNotification('Task assigned successfully!', 'success');
                e.target.reset();
                await loadTasksData();
                await loadTechnicianAvailability();
                loadRecentAssignments();
            } else {
                throw new Error('Failed to assign task');
            }

        } catch (error) {
            console.error('Task assignment error:', error);
            showNotification('Failed to assign task: ' + error.message, 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    }

    // Load recent assignments
    async function loadRecentAssignments() {
        const container = document.getElementById('recentAssignments');
        if (!container) return;

        try {
            const recentAssignments = tasksData
                .filter(task => task.assignedTechnicianStaff && task.creationDate)
                .sort((a, b) => new Date(b.creationDate) - new Date(a.creationDate))
                .slice(0, 5);

            if (recentAssignments.length === 0) {
                container.innerHTML = '<p style="color: var(--gray-medium);">No recent assignments</p>';
                return;
            }

            container.innerHTML = recentAssignments.map(task => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--gray-light);">
                    <div>
                        <strong>Task ${task.taskId}</strong><br>
                        <small style="color: var(--gray-medium);">${task.description}</small>
                    </div>
                    <div style="text-align: right;">
                        <div>${task.assignedTechnicianStaff.firstName} ${task.assignedTechnicianStaff.lastName}</div>
                        <div style="font-size: 0.8rem; color: var(--gray-medium);">
                            ${formatTimeAgo(new Date(task.creationDate))}
                        </div>
                    </div>
                </div>
            `).join('');

        } catch (error) {
            console.error('Error loading recent assignments:', error);
            container.innerHTML = '<p style="color: var(--secondary-red);">Error loading assignments</p>';
        }
    }

    // Load technician statistics
    async function loadTechnicianStats() {
        const selectedTechnicianId = document.getElementById('technicianStatsSelect')?.value;
        const timeRange = document.getElementById('statsTimeRange')?.value || 'month';

        try {
            // Filter technicians
            let technicians = staffData.filter(staff => staff.role === 'TECHNICIAN');
            if (selectedTechnicianId) {
                technicians = technicians.filter(tech => tech.id == selectedTechnicianId);
            }

            // Populate technician select if not already done
            const techStatsSelect = document.getElementById('technicianStatsSelect');
            if (techStatsSelect && techStatsSelect.children.length <= 1) {
                techStatsSelect.innerHTML = '<option value="">All Technicians</option>' +
                    staffData.filter(staff => staff.role === 'TECHNICIAN')
                        .map(tech => `<option value="${tech.id}">${tech.firstName} ${tech.lastName}</option>`)
                        .join('');
            }

            // Generate stats for each technician
            const statsGrid = document.getElementById('technicianStatsGrid');
            if (statsGrid) {
                const statsHTML = technicians.map(tech => {
                    const techTasks = tasksData.filter(task =>
                        task.assignedTechnicianStaff && task.assignedTechnicianStaff.id === tech.id
                    );

                    const completedTasks = techTasks.filter(task => task.status === 'COMPLETED').length;
                    const inProgressTasks = techTasks.filter(task => task.status === 'IN_PROGRESS').length;
                    const overdueTasks = techTasks.filter(task => {
                        if (!task.dueDate) return false;
                        return new Date(task.dueDate) < new Date() && task.status !== 'COMPLETED';
                    }).length;

                    const completionRate = techTasks.length > 0 ? ((completedTasks / techTasks.length) * 100).toFixed(1) : 0;

                    return `
                        <div class="stat-card">
                            <div class="stat-icon technicians">
                                <i class="fas fa-user-cog"></i>
                            </div>
                            <div class="stat-info">
                                <h3>${tech.firstName} ${tech.lastName}</h3>
                                <p>Completion Rate: ${completionRate}%</p>
                                <small style="color: var(--gray-medium);">
                                    ${techTasks.length} total, ${completedTasks} completed, ${overdueTasks} overdue
                                </small>
                            </div>
                        </div>
                    `;
                }).join('');

                statsGrid.innerHTML = statsHTML;
            }

            // Update detailed table
            const tbody = document.getElementById('technicianStatsTableBody');
            if (tbody) {
                tbody.innerHTML = technicians.map(tech => {
                    const techTasks = tasksData.filter(task =>
                        task.assignedTechnicianStaff && task.assignedTechnicianStaff.id === tech.id
                    );

                    const completedTasks = techTasks.filter(task => task.status === 'COMPLETED').length;
                    const inProgressTasks = techTasks.filter(task => task.status === 'IN_PROGRESS').length;
                    const overdueTasks = techTasks.filter(task => {
                        if (!task.dueDate) return false;
                        return new Date(task.dueDate) < new Date() && task.status !== 'COMPLETED';
                    }).length;

                    const completionRate = techTasks.length > 0 ? ((completedTasks / techTasks.length) * 100).toFixed(1) : 0;
                    const avgDuration = techTasks.length > 0 ?
                        Math.round(techTasks.reduce((sum, task) => sum + (task.estimatedDurationMinutes || 0), 0) / techTasks.length / 60) : 0;

                    const rating = completionRate >= 90 ? 'Excellent' :
                                  completionRate >= 75 ? 'Good' :
                                  completionRate >= 60 ? 'Average' : 'Needs Improvement';

                    return `
                        <tr>
                            <td>${tech.firstName} ${tech.lastName}</td>
                            <td>${techTasks.length}</td>
                            <td>${completedTasks}</td>
                            <td>${inProgressTasks}</td>
                            <td>${overdueTasks}</td>
                            <td>${completionRate}%</td>
                            <td>${avgDuration}h</td>
                            <td>
                                <span class="status-badge ${completionRate >= 75 ? 'active' : completionRate >= 60 ? 'pending' : 'inactive'}">
                                    ${rating}
                                </span>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // Create charts
            createTechnicianCharts(technicians);

        } catch (error) {
            console.error('Error loading technician stats:', error);
            showNotification('Error loading technician statistics', 'error');
        }
    }

    // Create technician charts
    function createTechnicianCharts(technicians) {
        // Task completion chart
        const completionCtx = document.getElementById('technicianCompletionChart');
        if (completionCtx) {
            destroyChart('technicianCompletion');

            const completionData = technicians.map(tech => {
                const techTasks = tasksData.filter(task =>
                    task.assignedTechnicianStaff && task.assignedTechnicianStaff.id === tech.id
                );
                const completedTasks = techTasks.filter(task => task.status === 'COMPLETED').length;
                return techTasks.length > 0 ? ((completedTasks / techTasks.length) * 100) : 0;
            });

            charts.technicianCompletion = new Chart(completionCtx, {
                type: 'bar',
                data: {
                    labels: technicians.map(tech => `${tech.firstName} ${tech.lastName}`),
                    datasets: [{
                        label: 'Completion Rate (%)',
                        data: completionData,
                        backgroundColor: completionData.map(rate =>
                            rate >= 90 ? '#10B981' :
                            rate >= 75 ? '#F59E0B' : '#DC2626'
                        )
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Performance comparison chart
        const performanceCtx = document.getElementById('technicianPerformanceChart');
        if (performanceCtx) {
            destroyChart('technicianPerformance');

            const taskCounts = technicians.map(tech => {
                return tasksData.filter(task =>
                    task.assignedTechnicianStaff && task.assignedTechnicianStaff.id === tech.id
                ).length;
            });

            charts.technicianPerformance = new Chart(performanceCtx, {
                type: 'radar',
                data: {
                    labels: technicians.map(tech => `${tech.firstName} ${tech.lastName}`),
                    datasets: [{
                        label: 'Total Tasks',
                        data: taskCounts,
                        borderColor: '#1E40AF',
                        backgroundColor: 'rgba(30, 64, 175, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    }

    // Generate reports
    async function generateReport(reportType) {
        try {
            showNotification(`Generating ${reportType} report...`, 'info');

            // Get report data based on type
            let reportData = {};
            let reportTitle = '';

            switch (reportType) {
                case 'monthly':
                    reportTitle = 'Monthly Maintenance Report';
                    reportData = await generateMonthlyReportData();
                    break;
                case 'weekly':
                    reportTitle = 'Weekly Maintenance Report';
                    reportData = await generateWeeklyReportData();
                    break;
                case 'annual':
                    reportTitle = 'Annual Maintenance Report';
                    reportData = await generateAnnualReportData();
                    break;
                case 'technician':
                    reportTitle = 'Technician Performance Report';
                    reportData = await generateTechnicianReportData();
                    break;
                case 'equipment':
                    reportTitle = 'Equipment Analysis Report';
                    reportData = await generateEquipmentReportData();
                    break;
                case 'inventory':
                    reportTitle = 'Inventory Report';
                    reportData = await generateInventoryReportData();
                    break;
                default:
                    throw new Error('Unknown report type');
            }

            // Generate PDF
            await generatePDFReport(reportTitle, reportData);

            showNotification(`${reportTitle} generated successfully!`, 'success');

        } catch (error) {
            console.error('Report generation error:', error);
            showNotification('Failed to generate report: ' + error.message, 'error');
        }
    }

    // Generate PDF report
    async function generatePDFReport(title, data) {
        if (typeof window.jspdf === 'undefined') {
            throw new Error('PDF library not available');
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Add logo
        try {
            const logoImg = new Image();
            logoImg.onload = function() {
                doc.addImage(logoImg, 'JPEG', 20, 20, 40, 20);
                addReportContent();
            };
            logoImg.onerror = function() {
                addReportContent();
            };
            logoImg.src = 'images/logoimas.jpg';
        } catch (error) {
            addReportContent();
        }

        function addReportContent() {
            // Header
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text(title, 70, 30);

            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 70, 40);

            let yPos = 60;

            // Add data sections
            Object.entries(data).forEach(([sectionTitle, sectionData]) => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(sectionTitle, 20, yPos);
                yPos += 10;

                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');

                if (Array.isArray(sectionData)) {
                    sectionData.forEach(item => {
                        if (yPos > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                        doc.text(`• ${item}`, 25, yPos);
                        yPos += 5;
                    });
                } else if (typeof sectionData === 'object') {
                    Object.entries(sectionData).forEach(([key, value]) => {
                        if (yPos > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                        doc.text(`${key}: ${value}`, 25, yPos);
                        yPos += 5;
                    });
                } else {
                    doc.text(String(sectionData), 25, yPos);
                    yPos += 5;
                }

                yPos += 10;
            });

            // Footer
            const pageCount = doc.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Page ${i} of ${pageCount}`, 20, 290);
                doc.text('Generated by IMAS - Intelligent Management & Analytics System', 150, 290);
            }

            doc.save(`${title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`);
        }
    }

    // Generate monthly report data
    async function generateMonthlyReportData() {
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();

        const monthlyEquipment = equipmentData.filter(eq => {
            if (!eq.lastMaintenanceDate) return false;
            const date = new Date(eq.lastMaintenanceDate);
            return date.getMonth() === thisMonth && date.getFullYear() === thisYear;
        });

        const monthlyTasks = tasksData.filter(task => {
            if (!task.creationDate) return false;
            const date = new Date(task.creationDate);
            return date.getMonth() === thisMonth && date.getFullYear() === thisYear;
        });

        return {
            'Executive Summary': {
                'Total Equipment Maintained': monthlyEquipment.length,
                'Tasks Created': monthlyTasks.length,
                'Tasks Completed': monthlyTasks.filter(t => t.status === 'COMPLETED').length,
                'Active Technicians': staffData.filter(s => s.role === 'TECHNICIAN').length
            },
            'Equipment Maintenance': monthlyEquipment.map(eq =>
                `${eq.name} (${eq.serialNumber}) - ${eq.location}`
            ),
            'Task Summary': monthlyTasks.map(task =>
                `${task.taskId}: ${task.description} - ${task.status}`
            ),
            'Recommendations': [
                'Continue preventive maintenance schedule',
                'Monitor equipment performance trends',
                'Ensure adequate spare parts inventory'
            ]
        };
    }

    // Generate Excel report
    async function generateExcelReport(reportType) {
        if (typeof XLSX === 'undefined') {
            showNotification('Excel library not available', 'error');
            return;
        }

        try {
            const wb = XLSX.utils.book_new();

            // Equipment sheet
            if (equipmentData.length > 0) {
                const equipmentSheet = XLSX.utils.json_to_sheet(equipmentData);
                XLSX.utils.book_append_sheet(wb, equipmentSheet, 'Equipment');
            }

            // Tasks sheet
            if (tasksData.length > 0) {
                const tasksSheet = XLSX.utils.json_to_sheet(tasksData.map(task => ({
                    ...task,
                    assignedTechnician: task.assignedTechnicianStaff ?
                        `${task.assignedTechnicianStaff.firstName} ${task.assignedTechnicianStaff.lastName}` :
                        'Unassigned',
                    equipment: task.relatedEquipment ? task.relatedEquipment.name : 'N/A'
                })));
                XLSX.utils.book_append_sheet(wb, tasksSheet, 'Tasks');
            }

            // Staff sheet
            if (staffData.length > 0) {
                const staffSheet = XLSX.utils.json_to_sheet(staffData);
                XLSX.utils.book_append_sheet(wb, staffSheet, 'Staff');
            }

            // Inventory sheet
            if (inventoryData.length > 0) {
                const inventorySheet = XLSX.utils.json_to_sheet(inventoryData);
                XLSX.utils.book_append_sheet(wb, inventorySheet, 'Inventory');
            }

            // Save file
            const fileName = `IMAS_${reportType}_Report_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);

            showNotification(`Excel report "${fileName}" downloaded successfully!`, 'success');

        } catch (error) {
            console.error('Excel generation error:', error);
            showNotification('Failed to generate Excel report: ' + error.message, 'error');
        }
    }

    // Export all data functions
    async function exportAllData(dataType, format) {
        try {
            let data = [];
            let filename = '';

            switch (dataType) {
                case 'equipment':
                    data = equipmentData;
                    filename = 'Equipment_Data';
                    break;
                case 'tasks':
                    data = tasksData;
                    filename = 'Tasks_Data';
                    break;
                case 'staff':
                    data = staffData;
                    filename = 'Staff_Data';
                    break;
                case 'inventory':
                    data = inventoryData;
                    filename = 'Inventory_Data';
                    break;
                case 'complete':
                    // Export all data in separate sheets
                    await exportCompleteData(format);
                    return;
            }

            if (format === 'excel') {
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(data);
                XLSX.utils.book_append_sheet(wb, ws, dataType);
                XLSX.writeFile(wb, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
            } else if (format === 'csv') {
                const csv = convertToCSV(data);
                downloadCSV(csv, `${filename}_${new Date().toISOString().split('T')[0]}.csv`);
            }

            showNotification(`${filename} exported successfully!`, 'success');

        } catch (error) {
            console.error('Export error:', error);
            showNotification('Failed to export data: ' + error.message, 'error');
        }
    }

    // Export complete database backup
    async function exportCompleteBackup() {
        try {
            showNotification('Creating complete database backup...', 'info');

            const backup = {
                exportDate: new Date().toISOString(),
                version: '1.0',
                data: {
                    equipment: equipmentData,
                    tasks: tasksData,
                    staff: staffData,
                    spareParts: sparePartsData,
                    inventory: inventoryData,
                    notifications: notifications
                },
                statistics: {
                    totalRecords: equipmentData.length + tasksData.length + staffData.length +
                                 sparePartsData.length + inventoryData.length,
                    equipmentCount: equipmentData.length,
                    tasksCount: tasksData.length,
                    staffCount: staffData.length,
                    sparePartsCount: sparePartsData.length,
                    inventoryCount: inventoryData.length
                }
            };

            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `IMAS_Complete_Backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('Complete database backup created successfully!', 'success');

        } catch (error) {
            console.error('Backup error:', error);
            showNotification('Failed to create backup: ' + error.message, 'error');
        }
    }

    // Helper functions
    function getStatusClass(status) {
        switch (status?.toUpperCase()) {
            case 'ACTIVE': return 'active';
            case 'INACTIVE': return 'inactive';
            case 'MAINTENANCE': return 'pending';
            case 'OUT_OF_ORDER': return 'inactive';
            default: return 'inactive';
        }
    }

    function getTaskStatusClass(status) {
        switch (status?.toUpperCase()) {
            case 'COMPLETED': return 'completed';
            case 'IN_PROGRESS': return 'in-progress';
            case 'ASSIGNED': return 'assigned';
            case 'PLANNED': return 'pending';
            case 'ON_HOLD': return 'inactive';
            default: return 'pending';
        }
    }

    function getStockStatus(quantity, minLevel) {
        if (quantity === 0) {
            return { class: 'inactive', text: 'Out of Stock' };
        } else if (quantity <= minLevel) {
            return { class: 'pending', text: 'Low Stock' };
        } else {
            return { class: 'active', text: 'In Stock' };
        }
    }

    function formatTimeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);

        if (diffInSeconds < 60) return 'Just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
        return `${Math.floor(diffInSeconds / 86400)}d ago`;
    }

    function convertToCSV(data) {
        if (data.length === 0) return '';

        const headers = Object.keys(data[0]);
        const csvHeaders = headers.join(',');

        const csvRows = data.map(row => {
            return headers.map(header => {
                const value = row[header];
                return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
            }).join(',');
        });

        return [csvHeaders, ...csvRows].join('\n');
    }

    function downloadCSV(csvContent, filename) {
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Search and filter functions
    function searchEquipment() {
        const searchTerm = document.getElementById('equipmentSearch').value.toLowerCase();
        const filteredData = equipmentData.filter(eq =>
            (eq.name || '').toLowerCase().includes(searchTerm) ||
            (eq.model || '').toLowerCase().includes(searchTerm) ||
            (eq.serialNumber || '').toLowerCase().includes(searchTerm) ||
            (eq.location || '').toLowerCase().includes(searchTerm)
        );
        displayFilteredEquipment(filteredData);
    }

    function filterEquipment() {
        const statusFilter = document.getElementById('equipmentStatusFilter').value;
        const locationFilter = document.getElementById('equipmentLocationFilter').value;

        let filteredData = equipmentData;

        if (statusFilter) {
            filteredData = filteredData.filter(eq => eq.status === statusFilter);
        }

        if (locationFilter) {
            filteredData = filteredData.filter(eq => eq.location === locationFilter);
        }

        displayFilteredEquipment(filteredData);
    }

    function displayFilteredEquipment(data) {
        const tbody = document.getElementById('equipmentTableBody');
        if (!tbody) return;

        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--gray-medium);">No equipment matches the filter criteria</td></tr>';
            return;
        }

        tbody.innerHTML = data.map(equipment => `
            <tr>
                <td>${equipment.equipmentId}</td>
                <td>${equipment.name || 'N/A'}</td>
                <td>${equipment.model || 'N/A'}</td>
                <td>${equipment.serialNumber || 'N/A'}</td>
                <td>${equipment.location || 'N/A'}</td>
                <td><span class="status-badge ${getStatusClass(equipment.status)}">${equipment.status || 'Unknown'}</span></td>
                <td>${equipment.lastMaintenanceDate ? new Date(equipment.lastMaintenanceDate).toLocaleDateString() : 'Never'}</td>
                <td>${equipment.nextMaintenanceDate ? new Date(equipment.nextMaintenanceDate).toLocaleDateString() : 'Not Scheduled'}</td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn view" onclick="viewEquipment(${equipment.equipmentId})" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editEquipment(${equipment.equipmentId})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteEquipment(${equipment.equipmentId})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `).join('');
    }

    // Similar search functions for other data types...
    function searchTasks() {
        const searchTerm = document.getElementById('taskSearch').value.toLowerCase();
        const filteredData = tasksData.filter(task =>
            (task.taskId || '').toLowerCase().includes(searchTerm) ||
            (task.description || '').toLowerCase().includes(searchTerm) ||
            (task.assignedTechnicianStaff?.firstName || '').toLowerCase().includes(searchTerm) ||
            (task.assignedTechnicianStaff?.lastName || '').toLowerCase().includes(searchTerm)
        );
        displayFilteredTasks(filteredData);
    }

    function filterTasks() {
        const statusFilter = document.getElementById('taskStatusFilter').value;
        const priorityFilter = document.getElementById('taskPriorityFilter').value;

        let filteredData = tasksData;

        if (statusFilter) {
            filteredData = filteredData.filter(task => task.status === statusFilter);
        }

        if (priorityFilter) {
            filteredData = filteredData.filter(task => task.priority === priorityFilter);
        }

        displayFilteredTasks(filteredData);
    }

    function displayFilteredTasks(data) {
        const tbody = document.getElementById('tasksTableBody');
        if (!tbody) return;

        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: var(--gray-medium);">No tasks match the filter criteria</td></tr>';
            return;
        }

        tbody.innerHTML = data.map(task => `
            <tr>
                <td>${task.taskId}</td>
                <td>${task.description || 'N/A'}</td>
                <td>${task.relatedEquipment ? task.relatedEquipment.name : 'N/A'}</td>
                <td>${task.assignedTechnicianStaff ? task.assignedTechnicianStaff.firstName + ' ' + task.assignedTechnicianStaff.lastName : 'Unassigned'}</td>
                <td><span class="priority-badge ${task.priority?.toLowerCase()}">${task.priority || 'N/A'}</span></td>
                <td><span class="status-badge ${getTaskStatusClass(task.status)}">${task.status || 'N/A'}</span></td>
                <td>${task.creationDate ? new Date(task.creationDate).toLocaleDateString() : 'N/A'}</td>
                <td>${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'Not Set'}</td>
                <td>
                    <div style="width: 100%; background: var(--gray-light); border-radius: 10px; overflow: hidden;">
                        <div style="background: var(--primary-blue); height: 6px; width: ${task.completionPercentage || 0}%; transition: width 0.3s ease;"></div>
                    </div>
                    <small>${task.completionPercentage || 0}%</small>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn view" onclick="viewTask('${task.taskId}')" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editTask('${task.taskId}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteTask('${task.taskId}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `).join('');
    }










// View Equipment
function viewEquipment(equipmentId) {
    const equipment = equipmentData.find(eq => eq.equipmentId == equipmentId);
    if (equipment) {
        document.getElementById('viewEquipmentName').textContent = equipment.name || 'N/A';
        document.getElementById('viewEquipmentModel').textContent = equipment.model || 'N/A';
        document.getElementById('viewEquipmentSerial').textContent = equipment.serialNumber || 'N/A';
        document.getElementById('viewEquipmentLocation').textContent = equipment.location || 'N/A';
        document.getElementById('viewEquipmentStatus').textContent = equipment.status || 'N/A';
        document.getElementById('viewEquipmentInstallDate').textContent =
            equipment.installationDate ? new Date(equipment.installationDate).toLocaleDateString() : 'N/A';
        document.getElementById('viewEquipmentLastMaintenance').textContent =
            equipment.lastMaintenanceDate ? new Date(equipment.lastMaintenanceDate).toLocaleDateString() : 'Never';
        document.getElementById('viewEquipmentInventoryId').textContent = equipment.inventoryId || 'N/A';
        document.getElementById('viewEquipmentDescription').textContent = equipment.description || 'No description';

        openModal('viewEquipmentModal');
    }
}




// Fonction pour éditer un équipement
function editEquipment(equipmentId) {
    const equipment = equipmentData.find(eq => eq.equipmentId == equipmentId);
    if (equipment) {
        // Populate form with existing data
        document.getElementById('equipmentName').value = equipment.name || '';
        document.getElementById('equipmentModel').value = equipment.model || '';
        document.getElementById('equipmentSerial').value = equipment.serialNumber || '';
        document.getElementById('equipmentLocation').value = equipment.location || '';
        document.getElementById('equipmentInstallDate').value = equipment.installationDate ?
            equipment.installationDate.split('T')[0] : '';
        document.getElementById('equipmentStatus').value = equipment.status || 'OPERATIONAL';
        document.getElementById('equipmentLastMaintenanceDate').value = equipment.lastMaintenanceDate ?
            equipment.lastMaintenanceDate.split('T')[0] : '';

        // Set inventory ID if exists
        if (equipment.inventoryId) {
            document.getElementById('equipmentInventoryId').value = equipment.inventoryId;
        }

        // Store equipment ID for update
        document.getElementById('equipmentForm').dataset.equipmentId = equipmentId;

        openModal('equipmentModal');
    }
}




// Delete equipment
async function deleteEquipment(equipmentId) {
    if (confirm('Are you sure you want to delete this equipment? This action cannot be undone.')) {
        try {
            const response = await fetch(`${API_BASE}/equipments/${equipmentId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': getAuthToken()
                }
            });

            if (response.ok) {
                showNotification('Equipment deleted successfully!', 'success');
                await loadEquipmentData();
            } else {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete equipment');
            }
        } catch (error) {
            console.error('Delete error:', error);
            showNotification('Failed to delete equipment: ' + error.message, 'error');
        }
    }
}



// Fixed loadInventoryOptions function
async function loadInventoryOptions() {
    try {
        const response = await fetchData('/inventory');
        const equipmentInventorySelect = document.getElementById('equipmentInventoryId');

        if (equipmentInventorySelect) {
            // Clear existing options except the first one
            equipmentInventorySelect.innerHTML = '<option value="">Select Inventory Item</option>';

            // Add inventory items
            response.forEach(item => {
                const option = document.createElement('option');
                option.value = item.inventoryId;
                option.textContent = `${item.inventoryCode} - ${item.name} (${item.itemType})`;
                equipmentInventorySelect.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Error loading inventory options:', error);
    }
}




// View task details
function viewTask(taskId) {
    const task = tasksData.find(t => t.taskId === taskId);
    if (!task) return;

    document.getElementById('viewTaskId').textContent = task.taskId || 'N/A';
    document.getElementById('viewTaskDescription').textContent = task.description || 'N/A';
    document.getElementById('viewTaskPriority').textContent = task.priority || 'N/A';
    document.getElementById('viewTaskStatus').textContent = task.status || 'N/A';
    document.getElementById('viewTaskCreated').textContent = task.creationDate ?
        new Date(task.creationDate).toLocaleString() : 'N/A';
    document.getElementById('viewTaskDueDate').textContent = task.dueDate ?
        new Date(task.dueDate).toLocaleString() : 'Not set';

    document.getElementById('viewTaskTechnician').textContent = task.assignedTechnicianStaff ?
        `${task.assignedTechnicianStaff.firstName} ${task.assignedTechnicianStaff.lastName}` : 'Unassigned';

    document.getElementById('viewTaskEquipment').textContent = task.relatedEquipment ?
        `${task.relatedEquipment.name} (${task.relatedEquipment.serialNumber})` : 'N/A';

    document.getElementById('viewTaskDuration').textContent = task.estimatedDurationMinutes ?
        `${task.estimatedDurationMinutes} minutes` : 'N/A';

    document.getElementById('viewTaskProgress').textContent = `${task.completionPercentage || 0}%`;

    // Store task ID in modal for edit/delete
    document.getElementById('viewTaskModal').dataset.taskId = taskId;

    openModal('viewTaskModal');
}

// Edit task from view modal
function editTaskFromView() {
    const taskId = document.getElementById('viewTaskModal').dataset.taskId;
    closeModal('viewTaskModal');
    editTask(taskId);
}

// Delete task from view modal
function deleteTaskFromView() {
    const taskId = document.getElementById('viewTaskModal').dataset.taskId;
    closeModal('viewTaskModal');
    deleteTask(taskId);
}

// Edit task - populate form
function editTask(taskId) {
    const task = tasksData.find(t => t.taskId === taskId);
    if (!task) return;

    document.getElementById('taskId').value = task.taskId || '';
    document.getElementById('taskDescription').value = task.description || '';
    document.getElementById('taskPriority').value = task.priority || 'MEDIUM';
    document.getElementById('taskDuration').value = task.estimatedDurationMinutes || '60';

    if (task.relatedEquipment) {
        document.getElementById('taskEquipment').value = task.relatedEquipment.equipmentId;
    }

    if (task.assignedTechnicianStaff) {
        document.getElementById('taskTechnician').value = task.assignedTechnicianStaff.id;
    }

    if (task.dueDate) {
        const dueDate = new Date(task.dueDate);
        document.getElementById('taskDueDate').value = dueDate.toISOString().slice(0, 16);
    }

    document.getElementById('taskSkills').value = task.requiredSkills?.join(', ') || '';
    document.getElementById('taskParts').value = task.requiredParts?.join(', ') || '';

    // Store task ID in form for update
    document.getElementById('taskForm').dataset.taskId = taskId;

    openModal('taskModal');
}

    // Refresh functions
    async function refreshDashboard() {
        showNotification('Refreshing dashboard data...', 'info');
        await loadDashboardData();
        showNotification('Dashboard data refreshed!', 'success');
    }

    async function refreshEquipmentData() {
        await loadEquipmentData();
        showNotification('Equipment data refreshed!', 'success');
    }

    async function refreshTasksData() {
        await loadTasksData();
        showNotification('Tasks data refreshed!', 'success');
    }

    async function refreshStaffData() {
        await loadStaffData();
        showNotification('Staff data refreshed!', 'success');
    }

    async function refreshSparePartsData() {
        await loadSparePartsData();
        showNotification('Spare parts data refreshed!', 'success');
    }

    async function refreshInventoryData() {
        await loadInventoryData();
        showNotification('Inventory data refreshed!', 'success');
    }

    async function refreshNotifications() {
        await loadNotifications();
        showNotification('Notifications refreshed!', 'success');
    }

    // Export functions
    async function exportEquipmentData() {
        await exportAllData('equipment', 'excel');
    }

    async function exportTasksData() {
        await exportAllData('tasks', 'excel');
    }

    async function exportStaffData() {
        await exportAllData('staff', 'excel');
    }

    async function exportSparePartsData() {
        await exportAllData('spare-parts', 'excel');
    }

    async function exportInventoryData() {
        await exportAllData('inventory', 'excel');
    }

    async function exportTechnicianStats() {
        try {
            const statsData = staffData.filter(staff => staff.role === 'TECHNICIAN').map(tech => {
                const techTasks = tasksData.filter(task =>
                    task.assignedTechnicianStaff && task.assignedTechnicianStaff.id === tech.id
                );

                const completedTasks = techTasks.filter(task => task.status === 'COMPLETED').length;
                const inProgressTasks = techTasks.filter(task => task.status === 'IN_PROGRESS').length;
                const overdueTasks = techTasks.filter(task => {
                    if (!task.dueDate) return false;
                    return new Date(task.dueDate) < new Date() && task.status !== 'COMPLETED';
                }).length;

                const completionRate = techTasks.length > 0 ? ((completedTasks / techTasks.length) * 100).toFixed(1) : 0;
                const avgDuration = techTasks.length > 0 ?
                    Math.round(techTasks.reduce((sum, task) => sum + (task.estimatedDurationMinutes || 0), 0) / techTasks.length / 60) : 0;

                return {
                    'Technician Name': `${tech.firstName} ${tech.lastName}`,
                    'Email': tech.email,
                    'Skills': tech.skills,
                    'Total Tasks': techTasks.length,
                    'Completed Tasks': completedTasks,
                    'In Progress Tasks': inProgressTasks,
                    'Overdue Tasks': overdueTasks,
                    'Completion Rate (%)': completionRate,
                    'Average Duration (hours)': avgDuration
                };
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(statsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Technician Statistics');
            XLSX.writeFile(wb, `Technician_Statistics_${new Date().toISOString().split('T')[0]}.xlsx`);

            showNotification('Technician statistics exported successfully!', 'success');

        } catch (error) {
            console.error('Export error:', error);
            showNotification('Failed to export technician statistics: ' + error.message, 'error');
        }
    }






// Modified showSection function to ensure combo boxes are populated
function showSection(sectionName, event) {
    console.log('📄 Showing section:', sectionName);

    // Hide all sections
    document.querySelectorAll('.section').forEach(section => {
        section.classList.add('hidden');
    });

    // Show target section
    const targetSection = document.getElementById(sectionName + '-section');
    if (targetSection) {
        targetSection.classList.remove('hidden');
    }

    // Update active menu item
    document.querySelectorAll('.sidebar-menu a').forEach(link => {
        link.classList.remove('active');
    });

    if (event) {
        const clickedLink = event.target.closest('a');
        if (clickedLink) {
            clickedLink.classList.add('active');
        }
    } else {
        const targetLink = document.querySelector(`[onclick*="${sectionName}"]`);
        if (targetLink) {
            targetLink.classList.add('active');
        }
    }

    // Load section-specific data and ensure combo boxes are populated
    switch(sectionName) {
        case 'dashboard':
            loadDashboardData();
            break;
        case 'equipment':
            loadEquipmentData();
            break;
        case 'tasks':
            // Ensure both equipment and technician combo boxes are populated for tasks
            Promise.all([
                loadTasksData(),
                loadEquipmentData(), // This will populate taskEquipment combo
                loadStaffData()      // This will populate taskTechnician combo
            ]);
            break;
        case 'staff':
            loadStaffData();
            break;
        case 'spare-parts':
            loadSparePartsData();
            break;
        case 'inventory':
            loadInventoryData();
            break;
        case 'task-assignment':
            // Ensure all combo boxes are populated for task assignment
            Promise.all([
                loadTasksData(),
                loadEquipmentData(),
                loadStaffData()
            ]);
            break;
        case 'technician-stats':
            loadTechnicianStats();
            break;
        case 'notifications':
            loadNotifications();
            break;
    }
}


function populateTaskEquipmentCombo() {
    console.log('🔧 Populating task equipment combo...');
    const taskEquipmentSelect = document.getElementById('taskEquipment');

    if (taskEquipmentSelect && equipmentData && equipmentData.length > 0) {
        console.log('✅ Found taskEquipment select and equipment data:', equipmentData.length, 'items');

        taskEquipmentSelect.innerHTML = '<option value="">Select Equipment</option>';

        equipmentData.forEach(equipment => {
            const option = document.createElement('option');
            option.value = equipment.equipmentId;
            option.textContent = `${equipment.name || 'N/A'} (${equipment.serialNumber || 'N/A'}) - ${equipment.location || 'N/A'}`;
            taskEquipmentSelect.appendChild(option);
        });

        console.log('✅ Task equipment combo populated with', equipmentData.length, 'options');
    } else {
        console.log('❌ Failed to populate task equipment combo:', {
            selectExists: !!taskEquipmentSelect,
            dataExists: !!equipmentData,
            dataLength: equipmentData ? equipmentData.length : 0
        });
    }
}




    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const header = document.getElementById('header');

        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');
        header.classList.toggle('expanded');
    }

    function toggleTheme() {
        const body = document.body;
        const themeToggle = document.getElementById('themeToggle');
        const icon = themeToggle.querySelector('i');

        if (body.getAttribute('data-theme') === 'dark') {
            body.setAttribute('data-theme', 'light');
            icon.className = 'fas fa-moon';
        } else {
            body.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
        }
    }

    function openModal(modalId) {
        document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');

        // Reset form if it exists
        const form = document.querySelector(`#${modalId} form`);
        if (form) {
            form.reset();
        }
    }

    function showNotification(message, type = 'info') {
        // Create or get notification container
        let container = document.getElementById('notificationContainer');
        if (!container) {
            container = document.createElement('div');
            container.id = 'notificationContainer';
            container.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 400px;
            `;
            document.body.appendChild(container);
        }

        // Create notification
        const notification = document.createElement('div');
        notification.style.cssText = `
            background: ${type === 'error' ? '#f8d7da' : type === 'success' ? '#d4edda' : type === 'warning' ? '#ffeeba' : '#d1ecf1'};
            color: ${type === 'error' ? '#721c24' : type === 'success' ? '#155724' : type === 'warning' ? '#856404' : '#0c5460'};
            border: 1px solid ${type === 'error' ? '#f5c6cb' : type === 'success' ? '#c3e6cb' : type === 'warning' ? '#ffeaa7' : '#bee5eb'};
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: slideIn 0.3s ease-out;
            cursor: pointer;
            font-weight: 500;
        `;

        notification.textContent = message;
        container.appendChild(notification);

        // Auto remove after 5 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease-in';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 5000);

        // Click to remove
        notification.addEventListener('click', () => {
            notification.style.animation = 'slideOut 0.3s ease-in';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        });
    }

    function handleLogout(event) {
        event.preventDefault();

        if (confirm('Are you sure you want to logout?')) {
            // Clear session data
            localStorage.removeItem('adminSession');
            localStorage.removeItem('authToken');
            sessionStorage.clear();

            // Redirect to login
            window.location.href = 'login.html';
        }
    }

    // API helper functions
    async function fetchData(endpoint) {
        try {
            const response = await fetch(`${API_BASE}${endpoint}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': getAuthToken()
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return Array.isArray(data) ? data : [];
        } catch (error) {
            console.error(`Fetch error for ${endpoint}:`, error);
            return [];
        }
    }

function getAuthToken() {
    const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
    return token;
}

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
        if (realTimeInterval) {
            clearInterval(realTimeInterval);
        }

        Object.keys(charts).forEach(key => {
            if (charts[key]) {
                charts[key].destroy();
            }
        });
    });

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
</script>
<script src="js/singleWindowValidator.js"></script>
</body>
</html>